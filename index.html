<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Valorforge - The Cofoundry</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Cinzel', 'Georgia', serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2416 100%);
            color: #d4af37;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            text-align: center;
            background: rgba(0, 0, 0, 0.6);
            padding: 60px 40px;
            border-radius: 10px;
            border: 2px solid #d4af37;
            box-shadow: 0 0 30px rgba(212, 175, 55, 0.3);
        }
        
        h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
            letter-spacing: 2px;
        }
        
        .subtitle {
            font-size: 1.2em;
            color: #b8960f;
            margin-bottom: 30px;
            font-style: italic;
        }
        
        .intro {
            font-size: 1.1em;
            line-height: 1.8;
            margin-bottom: 40px;
            color: #e6d5a0;
        }
        
        .hoard-display {
            background: rgba(0, 0, 0, 0.4);
            padding: 30px;
            border-radius: 8px;
            margin: 40px 0;
            border: 1px solid #8b7355;
        }
        
        .hoard-title {
            font-size: 1.5em;
            margin-bottom: 20px;
            color: #ffd700;
        }
        
        .metal-row {
            display: flex;
            justify-content: space-between;
            padding: 15px 20px;
            margin: 10px 0;
            background: rgba(139, 115, 85, 0.2);
            border-radius: 5px;
            font-size: 1.1em;
        }
        
        .metal-name {
            font-weight: bold;
        }
        
        .metal-weight {
            color: #fff;
        }
        
        .total-value {
            font-size: 1.8em;
            margin-top: 30px;
            padding: 20px;
            background: rgba(212, 175, 55, 0.1);
            border-radius: 5px;
            color: #ffd700;
        }
        
        /* LEADERBOARD STYLES */
        .leaderboard-display {
            background: rgba(0, 0, 0, 0.4);
            padding: 30px;
            border-radius: 8px;
            margin: 40px 0;
            border: 1px solid #8b7355;
        }
        
        .leaderboard-title {
            font-size: 1.5em;
            margin-bottom: 20px;
            color: #ffd700;
        }
        
        .dwarf-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            margin: 10px 0;
            background: rgba(139, 115, 85, 0.2);
            border-radius: 5px;
            font-size: 1.1em;
        }
        
        .dwarf-row.top-three {
            background: rgba(212, 175, 55, 0.3);
            border: 1px solid #d4af37;
        }
        
        .dwarf-rank {
            font-weight: bold;
            min-width: 50px;
            text-align: left;
        }
        
        .dwarf-name {
            flex: 1;
            text-align: left;
            padding: 0 20px;
        }
        
        .dwarf-gp {
            color: #ffd700;
            font-weight: bold;
        }
        
        .leaderboard-stats {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #8b7355;
            color: #b8960f;
            font-size: 0.9em;
        }
        
        /* PAGINATION STYLES */
        .pagination-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #8b7355;
        }
        
        .pagination-button {
            background: rgba(212, 175, 55, 0.2);
            border: 1px solid #d4af37;
            color: #d4af37;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Cinzel', 'Georgia', serif;
            font-size: 1em;
            transition: all 0.3s;
        }
        
        .pagination-button:hover:not(:disabled) {
            background: rgba(212, 175, 55, 0.4);
            transform: translateY(-2px);
        }
        
        .pagination-button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        .pagination-info {
            color: #b8960f;
            font-size: 0.9em;
        }
        
        .discord-button {
            display: inline-block;
            margin-top: 40px;
            padding: 20px 50px;
            background: #5865f2;
            color: white;
            text-decoration: none;
            font-size: 1.3em;
            border-radius: 8px;
            transition: all 0.3s;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(88, 101, 242, 0.4);
        }
        
        .discord-button:hover {
            background: #4752c4;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(88, 101, 242, 0.6);
        }
        
        .quote {
            margin-top: 40px;
            font-style: italic;
            color: #b8960f;
            font-size: 1em;
            line-height: 1.6;
        }
        
        .loading {
            font-size: 1.2em;
            color: #b8960f;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚öíÔ∏è COFOUNDRY ‚öíÔ∏è</h1>
        <p class="subtitle">Home of the Valorforge</p>
        
        <div class="intro">
            <p>Cofoundry is an invite only, dwarven-fantasy themed metal collecting co-op LARP game where we turn loot into treasure. 
            Join a Quest Party or adventure solo, collect treasure, earn Glory Points - 1 point per pound of copper or 10 per ounce of silver.</p>
            
            <p style="margin-top: 15px;">We melt our copper and cast it into bars. Other metals get scrapped for "vulgar currency" to buy silver and gold. 
            Liquidation can only occur with a 90% vote, almost certainly ensuring the hoard only ever accumulates. If liquidation occurs, payout is based on player's GP, ensuring payout based on participation. 
            Beyond that, parts of the hoard can be sold for vulgar currency to expand your local Cofoundry Commonwealth's Valorforge.</p>
            
            <p style="margin-top: 15px;">It's a long-term experiment to see how much precious metal we can accumulate together. Part LARP, part dwarven investment club, part environmental scavenging project, 100% real metal. 
            Want to quest with us?</p>
        </div>
        
        <div class="hoard-display">
            <div class="hoard-title">THE HOARD</div>
            <div id="hoard-data" class="loading">Loading The Hoard...</div>
        </div>
        
        <!-- LEADERBOARD SECTION -->
        <div class="leaderboard-display">
            <div class="leaderboard-title">üèÜ GLORY POINTS LEADERBOARD üèÜ</div>
            <div id="leaderboard-data" class="loading">Loading Leaderboard...</div>
        </div>
        
        <a href="https://discord.gg/R2WTXwbYah" class="discord-button" target="_blank">
            Join The Fellowship
        </a>
        
        <p class="quote" id="random-quote">
            <!-- Quote will be inserted here by JavaScript -->
        </p>
    </div>

    <script>
        // CONFIGURATION
        const SHEET_ID = '1-LJvYKvw0Pgt6vCA6aSFROMwsmY3JLraujWUSVbpAd8';
        const DWARVES_PER_PAGE = 10;
        
        // Global state for leaderboard
        let allDwarves = [];
        let currentPage = 1;
        
        // ROTATING QUOTES
        const FELLOWSHIP_QUOTES = [
            "We measure wealth in weight, not promises.",
            "The Hoard grows. It does not shrink.",
            "Every pound of copper, every ounce of silver, is a permanent contribution to something greater than yourself.",
            "What was stolen, we reclaim. What we forge, we keep.",
            "Value is not what you can spend, but what you can hold.",
            "We build what will outlast us all.",
            "The fellowship forges together what no individual could achieve alone.",
            "From scattered scrap, a mountain of metal.",
            "What the surface world discards, the dwarves reclaim.",
            "Each bar cast is a small victory against forgetting.",
            "The vulgar count their promises. We count our ounces.",
            "Wealth without weight is merely words.",
            "The furnace knows no lies. Only metal, heat, and truth.",
            "What hands have made, hands shall keep.",
            "Glory is not given. It is earned, pound by pound.",
            "The Hoard is the proof. The Fellowship is the power.",
            "Scrap today, treasure tomorrow, legacy forever.",
            "The mountain grows one stone at a time. The Hoard grows one quest at a time.",
            "Hollow Lords discarded it. Dwarven labor reclaimed it. The Hoard holds it.",
            "Value lies not in the promise of gold, but in the weight of it.",
            "We forge the future by melting the past.",
            "The bars remember every hand that forged them.",
            "What we build together, no one can take alone.",
            "Weight is truth. Purity is proof. The Hoard is both.",
            "From the furnace, permanence. From the fellowship, power.",
            "The ledger shows what dwarven labor creates. The vault holds what dwarven labor keeps.",
            "Every bar is a vote of confidence in the collective.",
            "What seems impossible to one becomes inevitable for many.",
            "We hoard not from fear of scarcity, but from love of abundance.",
            "The question is not if we can accumulate, but how much.",
            "Metal does not forget. The Hoard does not diminish. The Fellowship does not surrender.",
            "Every ounce is an argument. Every bar is a statement. The Hoard is the proof.",
            "The dwarves dig deeply because the surface is hollow.",
            "Cooperation beats competition when the goal is measured in centuries.",
            "The vault secures metal. The fellowship secures meaning.",
            "From scrap, through fire, into forever.",
            "The Hoard is patient. The Fellowship is persistent. Victory is inevitable.",
            "Each quest adds to the whole. Each dwarf strengthens the many."
        ];
        
        function getRandomQuote() {
            return FELLOWSHIP_QUOTES[Math.floor(Math.random() * FELLOWSHIP_QUOTES.length)];
        }
        
        function displayRandomQuote() {
            const quote = getRandomQuote();
            document.getElementById('random-quote').textContent = `"${quote}"`;
        }
        
        async function fetchHoardData() {
            try {
                console.log('Starting hoard fetch...');
                
                const sheetUrl = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=The%20Hoard`;
                const response = await fetch(sheetUrl);
                const text = await response.text();
                
                const jsonMatch = text.match(/google\.visualization\.Query\.setResponse\((.*)\);?\s*$/);
                const json = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(text.substr(47).slice(0, -2));
                
                const rows = json.table.rows;
                let metals = {};
                
                for (let i = 0; i < rows.length; i++) {
                    const cells = rows[i].c;
                    if (cells && cells[0] && cells[1]) {
                        const metalName = cells[0].v;
                        const weight = parseFloat(cells[1].v) || 0;
                        
                        if (metalName && weight > 0 && !metalName.toLowerCase().includes('hoard')) {
                            metals[metalName] = weight;
                        }
                    }
                }
                
                const ledgerUrl = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=The%20Great%20Ledger&range=K2:K5`;
                const pricesResponse = await fetch(ledgerUrl);
                const pricesText = await pricesResponse.text();
                const pricesJsonMatch = pricesText.match(/google\.visualization\.Query\.setResponse\((.*)\);?\s*$/);
                const pricesJson = pricesJsonMatch ? JSON.parse(pricesJsonMatch[1]) : JSON.parse(pricesText.substr(47).slice(0, -2));
                
                const pricesRows = pricesJson.table.rows;
                
                if (!pricesRows || pricesRows.length < 4) {
                    throw new Error('Not enough price data in sheet');
                }
                
                const prices = {
                    copper: parseFloat(pricesRows[0].c[0].v),
                    silver: parseFloat(pricesRows[1].c[0].v),
                    gold: parseFloat(pricesRows[2].c[0].v),
                    platinum: parseFloat(pricesRows[3].c[0].v)
                };
                
                displayHoard(metals, prices);
                
            } catch (error) {
                console.error('Hoard ERROR:', error);
                document.getElementById('hoard-data').innerHTML = 
                    `<p style="color: #ff6b6b;">Error loading data.</p>`;
            }
        }
        
        function displayHoard(metals, prices) {
            let totalValue = 0;
            let html = '';
            
            for (const [metal, weight] of Object.entries(metals)) {
                const metalLower = metal.toLowerCase();
                let value = 0;
                let emoji = '';
                let unit = 'oz';
                
                if (metalLower.includes('copper')) {
                    value = weight * prices.copper * 0.999;
                    emoji = 'üü§';
                } else if (metalLower.includes('silver')) {
                    value = weight * prices.silver * 0.999;
                    emoji = '‚ö™';
                } else if (metalLower.includes('gold')) {
                    value = weight * prices.gold * 0.999;
                    emoji = 'üü°';
                } else if (metalLower.includes('platinum')) {
                    value = weight * prices.platinum * 0.999;
                    emoji = '‚ö´';
                } else if (metalLower.includes('vulgar') || metalLower.includes('currency')) {
                    value = weight;
                    emoji = 'üíµ';
                    unit = 'USD';
                }
                
                totalValue += value;
                
                html += `
                    <div class="metal-row">
                        <span class="metal-name">${emoji} ${metal}</span>
                        <span class="metal-weight">${weight.toFixed(2)} ${unit}</span>
                    </div>
                `;
            }
            
            html += `
                <div class="total-value">
                    üí∞ $${totalValue.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}
                </div>
            `;
            
            document.getElementById('hoard-data').innerHTML = html;
        }
        
        async function fetchLeaderboard() {
            try {
                console.log('Starting leaderboard fetch...');
                
                const ledgerUrl = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=The%20Great%20Ledger`;
                const response = await fetch(ledgerUrl);
                const text = await response.text();
                
                const jsonMatch = text.match(/google\.visualization\.Query\.setResponse\((.*)\);?\s*$/);
                const json = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(text.substr(47).slice(0, -2));
                
                const rows = json.table.rows;
                let dwarves = [];
                
                for (let i = 1; i < rows.length; i++) {
                    const cells = rows[i].c;
                    if (cells && cells[1] && cells[7]) {
                        const dwarfName = cells[1].v;
                        const gloryPoints = parseFloat(cells[7].v) || 0;
                        
                        if (dwarfName && !dwarfName.toLowerCase().includes('hoard') && gloryPoints > 0) {
                            dwarves.push({
                                name: dwarfName,
                                gp: gloryPoints
                            });
                        }
                    }
                }
                
                dwarves.sort((a, b) => b.gp - a.gp);
                
                console.log('Found dwarves:', dwarves);
                
                allDwarves = dwarves;
                currentPage = 1;
                displayLeaderboard();
                
            } catch (error) {
                console.error('Leaderboard ERROR:', error);
                document.getElementById('leaderboard-data').innerHTML = 
                    `<p style="color: #ff6b6b;">Error loading leaderboard.</p>`;
            }
        }
        
        function displayLeaderboard() {
            let html = '';
            
            if (allDwarves.length === 0) {
                html = '<p style="color: #b8960f;">No Glory Points earned yet. Be the first!</p>';
            } else {
                const totalPages = Math.ceil(allDwarves.length / DWARVES_PER_PAGE);
                const startIndex = (currentPage - 1) * DWARVES_PER_PAGE;
                const endIndex = Math.min(startIndex + DWARVES_PER_PAGE, allDwarves.length);
                const pageDwarves = allDwarves.slice(startIndex, endIndex);
                
                // Display dwarves for current page
                pageDwarves.forEach((dwarf, pageIndex) => {
                    const actualRank = startIndex + pageIndex + 1;
                    let rankDisplay = '';
                    let topThreeClass = '';
                    
                    if (actualRank === 1) {
                        rankDisplay = 'ü•á';
                        topThreeClass = 'top-three';
                    } else if (actualRank === 2) {
                        rankDisplay = 'ü•à';
                        topThreeClass = 'top-three';
                    } else if (actualRank === 3) {
                        rankDisplay = 'ü•â';
                        topThreeClass = 'top-three';
                    } else {
                        rankDisplay = `${actualRank}.`;
                    }
                    
                    html += `
                        <div class="dwarf-row ${topThreeClass}">
                            <span class="dwarf-rank">${rankDisplay}</span>
                            <span class="dwarf-name">${dwarf.name}</span>
                            <span class="dwarf-gp">${dwarf.gp.toFixed(2)} GP</span>
                        </div>
                    `;
                });
                
                // Add pagination controls if more than 10 dwarves
                if (allDwarves.length > DWARVES_PER_PAGE) {
                    html += `
                        <div class="pagination-controls">
                            <button class="pagination-button" id="prev-button" ${currentPage === 1 ? 'disabled' : ''}>
                                ‚Üê Previous
                            </button>
                            <span class="pagination-info">
                                Page ${currentPage} of ${totalPages} (${allDwarves.length} dwarves)
                            </span>
                            <button class="pagination-button" id="next-button" ${currentPage === totalPages ? 'disabled' : ''}>
                                Next ‚Üí
                            </button>
                        </div>
                    `;
                }
                
                // Add stats
                const totalGP = allDwarves.reduce((sum, d) => sum + d.gp, 0);
                
                html += `
                    <div class="leaderboard-stats">
                        Total Dwarves: ${allDwarves.length} | Total Glory Earned: ${totalGP.toFixed(2)} GP
                    </div>
                `;
            }
            
            document.getElementById('leaderboard-data').innerHTML = html;
            
            // Add event listeners to pagination buttons if they exist
            if (allDwarves.length > DWARVES_PER_PAGE) {
                document.getElementById('prev-button').addEventListener('click', () => {
                    if (currentPage > 1) {
                        currentPage--;
                        displayLeaderboard();
                    }
                });
                
                document.getElementById('next-button').addEventListener('click', () => {
                    const totalPages = Math.ceil(allDwarves.length / DWARVES_PER_PAGE);
                    if (currentPage < totalPages) {
                        currentPage++;
                        displayLeaderboard();
                    }
                });
            }
        }
        
        // Display random quote on page load
        displayRandomQuote();
        
        // Load both hoard and leaderboard data immediately
        fetchHoardData();
        fetchLeaderboard();
        
        // Refresh both every 5 minutes
        setInterval(() => {
            fetchHoardData();
            fetchLeaderboard();
        }, 5 * 60 * 1000);
    </script>
</body>
</html>
