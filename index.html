<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cofoundry Quest - Dwarven Metal Collecting LARP Game | The Valorforge</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Cofoundry Quest is a dwarven-fantasy themed metal collecting co-op LARP game. Join our fellowship, collect precious metals, earn Glory Points, and build The Hoard together.">
    <meta name="keywords" content="cofoundry, cofoundry quest, valorforge, metal collecting, LARP game, dwarven fantasy, precious metals, copper collecting, silver stacking, scrap metal">
    <meta name="author" content="Cofoundry Quest">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://cofoundry.quest/">
    <meta property="og:title" content="Cofoundry Quest - The Valorforge">
    <meta property="og:description" content="Join our dwarven fellowship and turn scrap into treasure. A real-world metal collecting LARP game.">
    <meta property="og:site_name" content="Cofoundry Quest">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Cofoundry Quest - The Valorforge">
    <meta name="twitter:description" content="Dwarven-fantasy metal collecting co-op LARP game where we turn loot into treasure.">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://cofoundry.quest/">

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=MedievalSharp&family=Uncial+Antiqua&display=swap');
        
        /* CSS Variables for Day/Night Mode */
        :root {
            /* Day Mode Colors (default) */
            --bg-gradient-start: #1a1a1a;
            --bg-gradient-end: #2d2416;
            --container-bg: #c9b896;
            --panel-bg: #e8dcc4;
            --panel-dark: #d4c5a9;
            --text-color: #3d2817;
            --text-secondary: #5d4a36;
            --border-dark: #3d2817;
            --border-medium: #8b6f47;
            --border-light: #5d4a36;
            --gold: #ffd700;
            --gold-dark: #daa520;
            --gold-text: #d4af37;
            --text-shadow-color: #d4af37;
        }

        [data-theme="night"] {
            /* Night Mode Colors */
            --bg-gradient-start: #0a0e1a;
            --bg-gradient-end: #1a1e2d;
            --container-bg: #2d3748;
            --panel-bg: #374151;
            --panel-dark: #1f2937;
            --text-color: #f0f9ff;
            --text-secondary: #e0f2fe;
            --border-dark: #1a202c;
            --border-medium: #4a5568;
            --border-light: #2d3748;
            --gold: #fbbf24;
            --gold-dark: #d97706;
            --gold-text: #fcd34d;
            --text-shadow-color: #1e293b;
        }

        /* Night mode specific adjustments for better contrast */
        [data-theme="night"] .profile-section-title {
            text-shadow: 1px 1px 0 var(--text-shadow-color);
        }

        [data-theme="night"] .quest-text {
            text-shadow: 
                2px 2px 0 var(--text-shadow-color),
                3px 3px 10px rgba(0,0,0,0.8);
        }

        [data-theme="night"] .metal-row,
        [data-theme="night"] .dwarf-row {
            background: var(--panel-dark);
            border-color: var(--border-medium);
        }

        [data-theme="night"] .metal-row:hover,
        [data-theme="night"] .dwarf-row:hover {
            background: #374151;
        }

        /* Keep top 3 visible in night mode */
        [data-theme="night"] .dwarf-row.top-three {
            background: #29394D;
            border-color: var(--gold-dark);
            color: #fef3c7;
        }

        /* Better contrast for text in night mode */
        [data-theme="night"] .metal-weight,
        [data-theme="night"] .dwarf-gp {
            color: #e0f2fe;
        }

        [data-theme="night"] .metal-name,
        [data-theme="night"] .dwarf-name {
            color: #f0f9ff;
        }

        [data-theme="night"] .dwarf-rank {
            color: #f0f9ff;
        }

        [data-theme="night"] .leaderboard-stats,
        [data-theme="night"] .pagination-info {
            color: #e0f2fe;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'MedievalSharp', 'Courier New', monospace;
            background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
            transition: background 0.5s ease, color 0.3s ease;
        }
        
        /* Theme Toggle Button */
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: linear-gradient(180deg, var(--border-medium) 0%, var(--border-light) 100%);
            border: 4px solid var(--border-dark);
            border-radius: 50%;
            cursor: pointer;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            box-shadow: 3px 3px 0 var(--border-dark);
            transition: all 0.2s ease;
        }

        .theme-toggle:hover {
            transform: translate(1px, 1px);
            box-shadow: 2px 2px 0 var(--border-dark);
        }

        .theme-toggle:active {
            transform: translate(3px, 3px);
            box-shadow: none;
        }

        .theme-icon {
            filter: drop-shadow(0 0 3px rgba(255, 215, 0, 0.5));
        }

        [data-theme="night"] .theme-icon {
            filter: drop-shadow(0 0 5px rgba(251, 191, 36, 0.8));
        }
        
        /* Castle wall borders - cobblestone texture */
        body::before,
        body::after {
            content: '';
            position: fixed;
            top: 0;
            bottom: 0;
            width: 120px;
            background-image: url('cobblestone.png');
            background-size: 120px auto;
            background-repeat: repeat-y;
            background-position: center;
            box-shadow: 
                inset 0 0 80px rgba(0,0,0,0.5),
                inset 20px 0 40px rgba(0,0,0,0.4),
                inset -20px 0 40px rgba(0,0,0,0.4);
            z-index: 1000;
            pointer-events: none;
            transition: filter 0.5s ease;
        }

        /* Warm torch lighting on pillars - day mode */
        body::before {
            left: 0;
            filter: brightness(0.8) contrast(1.1) sepia(0.15) saturate(1.2) hue-rotate(-10deg);
        }

        body::after {
            right: 0;
            filter: brightness(0.8) contrast(1.1) sepia(0.15) saturate(1.2) hue-rotate(-10deg);
        }

        /* Cool moonlight on pillars - night mode */
        [data-theme="night"] body::before,
        [data-theme="night"] body::after {
            filter: brightness(0.6) contrast(1.15) saturate(0.7) hue-rotate(200deg);
        }

        /* Shadow gradient behind pillars */
        .shadow-gradient-left,
        .shadow-gradient-right {
            position: fixed;
            top: 0;
            bottom: 0;
            width: 400px;
            pointer-events: none;
            z-index: 999;
        }

        .shadow-gradient-left {
            left: 0;
            background: linear-gradient(90deg, 
                rgba(0, 0, 0, 0.8) 0%,
                rgba(0, 0, 0, 0.5) 120px,
                rgba(0, 0, 0, 0.3) 200px,
                rgba(0, 0, 0, 0.1) 300px,
                transparent 400px
            );
        }

        .shadow-gradient-right {
            right: 0;
            background: linear-gradient(270deg, 
                rgba(0, 0, 0, 0.8) 0%,
                rgba(0, 0, 0, 0.5) 120px,
                rgba(0, 0, 0, 0.3) 200px,
                rgba(0, 0, 0, 0.1) 300px,
                transparent 400px
            );
        }

        /* Torches at bottom of pillars */
        .torch {
            position: fixed;
            bottom: 30px;
            width: 80px;
            height: 120px;
            z-index: 1001;
            pointer-events: none;
            display: flex;
            justify-content: center;
            align-items: flex-end;
        }

        .torch-left {
            left: 20px;
        }

        .torch-right {
            right: 20px;
        }

        /* Torch image */
        .torch-image {
            width: 100%;
            height: auto;
            position: relative;
            z-index: 2;
            filter: drop-shadow(0 0 8px rgba(255, 150, 0, 0.6));
            transition: filter 0.5s ease;
        }

        /* Bloom/glow effect around lit torches */
        .torch-glow {
            position: absolute;
            bottom: 40%;
            left: 50%;
            transform: translate(-50%, 50%);
            width: 150px;
            height: 150px;
            background: radial-gradient(circle, 
                rgba(255, 150, 0, 0.4) 0%,
                rgba(255, 100, 0, 0.2) 30%,
                rgba(255, 80, 0, 0.1) 50%,
                transparent 70%
            );
            border-radius: 50%;
            filter: blur(40px);
            animation: torchGlowPulse 2s ease-in-out infinite;
            z-index: 1;
            transition: opacity 0.5s ease;
        }

        /* Glow pulse animation */
        @keyframes torchGlowPulse {
            0%, 100% {
                opacity: 0.6;
                transform: translate(-50%, 50%) scale(1);
            }
            50% {
                opacity: 1;
                transform: translate(-50%, 50%) scale(1.15);
            }
        }

        /* Ambient light cast on pillar/wall */
        .torch::after {
            content: '';
            position: absolute;
            bottom: 30%;
            left: 50%;
            transform: translateX(-50%);
            width: 150px;
            height: 150px;
            background: radial-gradient(circle, 
                rgba(255, 150, 0, 0.12) 0%,
                rgba(255, 120, 0, 0.06) 40%,
                transparent 70%
            );
            border-radius: 50%;
            filter: blur(25px);
            animation: ambientGlow 3s ease-in-out infinite;
            z-index: 0;
            transition: opacity 0.5s ease;
        }

        @keyframes ambientGlow {
            0%, 100% {
                opacity: 0.5;
            }
            50% {
                opacity: 0.8;
            }
        }

        /* Night mode - completely disable torch glow and switch to unlit torch */
        [data-theme="night"] .torch-glow {
            display: none;
        }

        [data-theme="night"] .torch::after {
            display: none;
        }

        [data-theme="night"] .torch-image {
            filter: drop-shadow(0 0 2px rgba(100, 100, 100, 0.3));
        }

        /* Responsive */
        @media (max-width: 1200px) {
            body::before,
            body::after {
                width: 80px;
                background-size: 80px auto;
                transition: filter 0.5s ease;
            }
            
            .shadow-gradient-left,
            .shadow-gradient-right {
                width: 300px;
            }
            
            .shadow-gradient-left {
                background: linear-gradient(90deg, 
                    rgba(0, 0, 0, 0.8) 0%,
                    rgba(0, 0, 0, 0.4) 80px,
                    rgba(0, 0, 0, 0.2) 150px,
                    transparent 300px
                );
            }
            
            .shadow-gradient-right {
                background: linear-gradient(270deg, 
                    rgba(0, 0, 0, 0.8) 0%,
                    rgba(0, 0, 0, 0.4) 80px,
                    rgba(0, 0, 0, 0.2) 150px,
                    transparent 300px
                );
            }

            .torch {
                width: 70px;
                height: 105px;
                bottom: 25px;
            }
            
            .torch-left {
                left: 18px;
            }
            
            .torch-right {
                right: 18px;
            }
            
            .torch-glow {
                width: 160px;
                height: 160px;
            }
            
            .torch::after {
                width: 200px;
                height: 200px;
            }
        }

        @media (max-width: 900px) {
            body::before,
            body::after {
                width: 40px;
                background-size: 40px auto;
                transition: filter 0.5s ease;
            }
            
            .shadow-gradient-left,
            .shadow-gradient-right {
                width: 200px;
            }

            .torch {
                width: 50px;
                height: 75px;
                bottom: 20px;
            }
            
            .torch-left {
                left: 10px;
            }
            
            .torch-right {
                right: 10px;
            }
            
            .torch-glow {
                width: 140px;
                height: 140px;
            }
            
            .torch::after {
                width: 170px;
                height: 170px;
            }
        }

        @media (max-width: 600px) {
            body::before,
            body::after {
                display: none;
            }
            
            .shadow-gradient-left,
            .shadow-gradient-right {
                display: none;
            }

            .torch {
                display: none;
            }

            .theme-toggle {
                top: 15px;
                right: 15px;
                width: 45px;
                height: 45px;
                font-size: 1.3em;
            }
        }
        
        .container {
            max-width: 900px;
            background: var(--container-bg);
            background-image: 
                radial-gradient(rgba(0,0,0,.1) 1px, transparent 1px),
                radial-gradient(rgba(0,0,0,.1) 1px, transparent 1px);
            background-size: 4px 4px;
            background-position: 0 0, 2px 2px;
            padding: 0;
            border: 8px solid var(--border-dark);
            box-shadow: 
                0 0 0 2px var(--border-medium),
                inset 0 0 0 2px var(--border-medium),
                0 10px 30px rgba(0,0,0,0.7);
            transition: background 0.3s ease, border-color 0.3s ease;
        }
        
        .header {
            background: linear-gradient(180deg, var(--border-medium) 0%, var(--border-light) 100%);
            border-bottom: 4px solid var(--border-dark);
            padding: 0;
            text-align: center;
            box-shadow: inset 0 -4px 8px rgba(0,0,0,0.3);
            transition: background 0.3s ease;
            overflow: hidden;
            position: relative;
        }

        .header-banner {
            width: 100%;
            height: auto;
            display: block;
            max-width: 100%;
            transition: opacity 0.5s ease;
        }

        /* Hide the old text elements when using banner */
        .header h1,
        .header .quest-text,
        .header .quest-separator,
        .header .subtitle {
            display: none;
        }
        
        h1 {
            font-family: 'MedievalSharp', 'Courier New', monospace;
            font-size: 3em;
            font-weight: bold;
            color: var(--gold);
            text-shadow: 
                4px 4px 0 var(--border-dark),
                -2px -2px 0 var(--border-dark),
                2px -2px 0 var(--border-dark),
                -2px 2px 0 var(--border-dark),
                2px 2px 0 var(--border-dark),
                5px 5px 10px rgba(0,0,0,0.8);
            letter-spacing: 5px;
            margin-bottom: 10px;
            text-transform: uppercase;
            transition: color 0.3s ease, text-shadow 0.3s ease;
        }

        /* Simplified shadow for night mode */
        [data-theme="night"] h1 {
            text-shadow: 
                3px 3px 0 var(--text-shadow-color),
                4px 4px 10px rgba(0,0,0,0.9);
        }
        
        .subtitle {
            font-family: 'MedievalSharp', 'Courier New', monospace;
            font-size: 1.2em;
            color: var(--gold-text);
            font-style: italic;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
            letter-spacing: 2px;
        }

        .quest-text {
            font-family: 'MedievalSharp', 'Courier New', monospace;
            font-size: 4.5em;
            font-weight: bold;
            color: #c9783a;
            text-align: center;
            letter-spacing: 25px;
            margin: -5px 0 15px 0;
            text-transform: uppercase;
            text-shadow: 
                2px 2px 0 var(--border-light),
                3px 3px 0 #4a3829,
                4px 4px 0 var(--border-dark),
                5px 5px 0 #2b1810,
                6px 6px 10px rgba(0,0,0,0.7),
                7px 7px 15px rgba(0,0,0,0.5);
            padding-left: 25px;
        }

        .quest-separator {
            width: 80%;
            height: 3px;
            background: var(--border-light);
            margin: 15px auto;
            box-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }

        /* Responsive banner adjustments */
        @media (max-width: 768px) {
            .header-banner {
                max-height: 200px;
                object-fit: cover;
                object-position: center;
            }
        }

        @media (max-width: 600px) {
            .header-banner {
                max-height: 150px;
            }
        }
        
        .content-area {
            padding: 30px;
        }
        
        /* ================================================
           SCROLL INTRO SECTION
           ================================================ */
        
        .intro {
            background: transparent;
            border: none;
            padding: 120px 60px 120px 60px; /* ← ADJUST: Top/bottom padding for cap overlap */
            margin: 40px 0;
            font-size: 0.95em;
            line-height: 1.7;
            text-align: center;
            position: relative;
            color: #2d1810;
            min-height: 200px;
        }

        /* Top scroll cap (BEHIND the middle parchment) */
        .intro-scroll-top {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 150px; /* ← ADJUST: Based on your scroll-top.png height */
            background: url('scroll-top.png') no-repeat center top;
            background-size: 100% auto;
            z-index: 2; /* above middle */
            pointer-events: none;
        }

        /* Bottom scroll cap (BEHIND the middle parchment) */
        .intro-scroll-bottom {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 150px; /* ← ADJUST: Based on your scroll-bottom.png height */
            background: url('scroll-bottom.png') no-repeat center bottom;
            background-size: 100% auto;
            z-index: 2; /* above middle */
            pointer-events: none;
        }

        /* Parchment background with tattered edges (ABOVE the caps) */
        .intro::before {
            content: '';
            position: absolute;
            top: 0px;    /* ← ADJUST: How much the middle overlaps the top cap */
            left: 0;
            right: 0;
            bottom: 0px; /* ← ADJUST: How much the middle overlaps the bottom cap */
            background: url('scroll-middle.png') repeat-y center top;
            background-size: 100% auto;
            z-index: 1; /* behind the caps so dithered edges overlap */
        }

        /* Make text sit above everything */
        .intro p {
            position: relative;
            z-index: 4; /* Above all scroll elements */
            margin-bottom: 15px;
        }
        
        .intro p:last-child {
            margin-bottom: 0;
        }

        /* Night mode adjustments */
        [data-theme="night"] .intro {
            color: #e8d4b0;
        }

        /* Mobile scroll adjustments */
        @media (max-width: 768px) {
            .intro {
                padding: 100px 30px;
            }
            
            .intro-scroll-top,
            .intro-scroll-bottom {
                height: 120px; /* ← ADJUST: Smaller caps on mobile */
            }
            
            .intro::before {
                top: 0px;    /* ← ADJUST: Mobile overlap values */
                bottom: 0px;
            }
        }
        
        /* ================================================
           END SCROLL SECTION
           ================================================ */
        
        .panel {
            background: var(--panel-bg);
            border: 4px solid var(--border-dark);
            padding: 20px;
            margin: 30px 0;
            box-shadow: 
                inset 2px 2px 4px rgba(0,0,0,0.2),
                4px 4px 0 var(--border-medium);
            position: relative;
            transition: background 0.3s ease, border-color 0.3s ease;
        }
        
        .panel::before {
            content: '';
            position: absolute;
            top: -4px;
            left: -4px;
            right: -4px;
            height: 8px;
            background: linear-gradient(90deg, var(--border-medium) 0%, var(--border-light) 50%, var(--border-medium) 100%);
            transition: background 0.3s ease;
        }
        
        .panel-title {
            font-family: 'MedievalSharp', 'Courier New', monospace;
            font-size: 1.8em;
            font-weight: bold;
            color: var(--text-color);
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 2px 2px 0 var(--text-shadow-color);
            letter-spacing: 3px;
            text-transform: uppercase;
            transition: color 0.3s ease, text-shadow 0.3s ease;
        }
        
        .metal-row {
            background: var(--panel-dark);
            border: 3px solid var(--border-dark);
            padding: 12px 15px;
            margin: 8px 0;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            box-shadow: 2px 2px 0 var(--border-medium);
            font-size: 1.5em;
            text-align: center;
            transition: background 0.3s ease;
        }
        
        .metal-row:hover {
            background: var(--container-bg);
        }

        .dwarf-row {
            background: var(--panel-dark);
            border: 3px solid var(--border-dark);
            padding: 12px 15px 12px 45px;
            margin: 8px 0;
            display: flex;
            justify-content: flex-start;
            align-items: center;
            gap: 20px;
            box-shadow: 2px 2px 0 var(--border-medium);
            font-size: 1em;
            text-align: center;
            position: relative;
            transition: background 0.3s ease;
        }

        .dwarf-row:hover {
            background: var(--container-bg);
        }
        
        .dwarf-row.top-three {
            background: var(--gold);
            border-color: var(--border-medium);
            box-shadow: 
                2px 2px 0 var(--border-medium),
                0 0 10px rgba(255, 215, 0, 0.3);
        }

        .dwarf-rank {
            font-weight: bold;
            min-width: 30px;
            font-size: 1.2em;
            text-align: left;
            position: absolute;
            left: 15px;
        }

        .dwarf-name {
            cursor: pointer;
            transition: color 0.2s;
            flex: 1;
            text-align: center;
            font-weight: bold;
        }

        .dwarf-name:hover {
            color: var(--gold);
            text-decoration: underline;
        }

        .dwarf-gp {
            color: #8b4513;
            font-weight: bold;
            min-width: 100px;
            text-align: right;
        }
        
        .metal-name {
            font-weight: bold;
        }
        
        .metal-weight {
            color: #8b4513;
            font-weight: bold;
        }
        
        .total-value {
            background: linear-gradient(180deg, var(--gold) 0%, var(--gold-dark) 100%);
            border: 4px solid var(--border-dark);
            padding: 20px;
            margin-top: 20px;
            text-align: center;
            font-size: 1em;
            font-weight: bold;
            color: var(--border-dark);
            text-shadow: 1px 1px 0 #fff;
            box-shadow: 
                inset 0 2px 4px rgba(255,255,255,0.5),
                2px 2px 0 var(--border-medium);
            transition: background 0.3s ease;
        }
        
        .leaderboard-stats {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 3px solid var(--border-medium);
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.9em;
        }
        
        .pagination-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 3px solid var(--border-medium);
        }
        
        .pagination-button {
            background: linear-gradient(180deg, var(--border-medium) 0%, var(--border-light) 100%);
            border: 3px solid var(--border-dark);
            color: var(--gold);
            padding: 10px 20px;
            cursor: pointer;
            font-family: 'MedievalSharp', 'Courier New', monospace;
            font-size: 1em;
            font-weight: bold;
            box-shadow: 2px 2px 0 var(--border-dark);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            transition: all 0.2s ease;
        }
        
        .pagination-button:hover:not(:disabled) {
            background: linear-gradient(180deg, #a0805a 0%, #6b5943 100%);
            transform: translate(1px, 1px);
            box-shadow: 1px 1px 0 var(--border-dark);
        }
        
        .pagination-button:active:not(:disabled) {
            transform: translate(2px, 2px);
            box-shadow: none;
        }
        
        .pagination-button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        
        .pagination-info {
            color: var(--text-secondary);
            font-weight: bold;
        }
        
        .apply-button {
            display: inline-block;
            margin: 30px auto 10px auto;
            padding: 15px 40px;
            background: linear-gradient(180deg, var(--border-medium) 0%, var(--border-light) 100%);
            color: var(--gold);
            text-decoration: none;
            font-size: 1.3em;
            font-weight: bold;
            border: 4px solid var(--border-dark);
            cursor: pointer;
            box-shadow: 4px 4px 0 var(--border-dark);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            transition: all 0.1s;
        }
        
        .apply-button:hover {
            background: linear-gradient(180deg, #a0805a 0%, #6b5943 100%);
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0 var(--border-dark);
        }
        
        .apply-button:active {
            transform: translate(4px, 4px);
            box-shadow: none;
        }

        .discord-link {
            display: block;
            text-align: center;
            margin: 10px auto 20px auto;
            color: var(--text-secondary);
            font-size: 0.9em;
            text-decoration: none;
            transition: color 0.2s;
        }

        .discord-link:hover {
            color: #7289da;
            text-decoration: underline;
        }
        
        .button-container {
            text-align: center;
        }
        
        .quote {
            background: var(--border-medium);
            border: 4px solid var(--border-dark);
            padding: 20px;
            margin-top: 30px;
            font-style: italic;
            color: var(--gold);
            text-align: center;
            font-size: 1em;
            line-height: 1.6;
            box-shadow: 
                inset 2px 2px 4px rgba(0,0,0,0.3),
                2px 2px 0 var(--border-light);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            transition: background 0.3s ease;
        }
        
        .loading {
            font-size: 1.2em;
            color: var(--border-medium);
            text-align: center;
            padding: 20px;
        }
        
        /* Retro scrollbar */
        ::-webkit-scrollbar {
            width: 16px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--border-medium);
            border: 2px solid var(--border-dark);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--border-light);
            border: 2px solid var(--border-dark);
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #4a3829;
        }
        
        /* Application Modal */
        .application-modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            animation: fadeIn 0.3s ease;
        }

        .application-modal.active {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .application-content {
            background: var(--container-bg);
            background-image: 
                radial-gradient(rgba(0,0,0,.1) 1px, transparent 1px),
                radial-gradient(rgba(0,0,0,.1) 1px, transparent 1px);
            background-size: 4px 4px;
            background-position: 0 0, 2px 2px;
            border: 8px solid var(--border-dark);
            box-shadow: 
                0 0 0 2px var(--border-medium),
                inset 0 0 0 2px var(--border-medium),
                0 20px 60px rgba(0,0,0,0.9);
            padding: 0;
            max-width: 800px;
            width: 95%;
            max-height: 90vh;
            overflow: hidden;
            position: relative;
            animation: slideDown 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .application-header {
            background: linear-gradient(180deg, var(--border-medium) 0%, var(--border-light) 100%);
            border-bottom: 4px solid var(--border-dark);
            padding: 20px;
            text-align: center;
            box-shadow: inset 0 -4px 8px rgba(0,0,0,0.3);
            flex-shrink: 0;
        }

        .application-title {
            font-family: 'MedievalSharp', 'Courier New', monospace;
            font-size: 2em;
            font-weight: bold;
            color: var(--gold);
            text-shadow: 
                3px 3px 0 var(--border-dark),
                4px 4px 10px rgba(0,0,0,0.8);
            letter-spacing: 3px;
            text-transform: uppercase;
            margin: 0;
        }

        .application-body {
            flex: 1;
            overflow-y: auto;
            padding: 0;
            position: relative;
        }

        /* Match main page scrollbar for modal */
        .application-body::-webkit-scrollbar {
            width: 16px;
        }

        .application-body::-webkit-scrollbar-track {
            background: var(--border-medium);
            border: 2px solid var(--border-dark);
        }

        .application-body::-webkit-scrollbar-thumb {
            background: var(--border-light);
            border: 2px solid var(--border-dark);
        }

        .application-body::-webkit-scrollbar-thumb:hover {
            background: #4a3829;
        }

        /* Firefox scrollbar */
        .application-body {
            scrollbar-width: auto;
            scrollbar-color: var(--border-light) var(--border-medium);
        }

        .application-body iframe {
            width: 100%;
            height: 100%;
            min-height: 600px;
            border: none;
        }

        /* Cover Google branding bar at bottom */
        .application-body::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: var(--container-bg);
            background-image: 
                radial-gradient(rgba(0,0,0,.1) 1px, transparent 1px),
                radial-gradient(rgba(0,0,0,.1) 1px, transparent 1px);
            background-size: 4px 4px;
            background-position: 0 0, 2px 2px;
            pointer-events: none;
            z-index: 10;
            box-shadow: inset 0 4px 8px rgba(0,0,0,0.2);
        }

        /* Optional: Decorative border to reinforce coverage */
        .application-content::before {
            content: '';
            position: absolute;
            bottom: 55px;
            left: 0;
            right: 0;
            height: 8px;
            background: linear-gradient(90deg, var(--border-medium) 0%, var(--border-light) 50%, var(--border-medium) 100%);
            z-index: 11;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .application-close {
            background: linear-gradient(180deg, var(--border-medium) 0%, var(--border-light) 100%);
            border: 4px solid var(--border-dark);
            border-left: none;
            border-right: none;
            border-bottom: none;
            color: var(--gold);
            padding: 15px;
            cursor: pointer;
            font-family: 'MedievalSharp', 'Courier New', monospace;
            font-size: 1.2em;
            font-weight: bold;
            box-shadow: inset 0 4px 8px rgba(0,0,0,0.3);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            width: 100%;
            flex-shrink: 0;
        }

        .application-close:hover {
            background: linear-gradient(180deg, #a0805a 0%, #6b5943 100%);
        }

        /* Dwarf Profile Modal */
        .profile-modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            animation: fadeIn 0.3s ease;
        }

        .profile-modal.active {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .profile-content {
            background: var(--container-bg);
            background-image: 
                radial-gradient(rgba(0,0,0,.1) 1px, transparent 1px),
                radial-gradient(rgba(0,0,0,.1) 1px, transparent 1px);
            background-size: 4px 4px;
            background-position: 0 0, 2px 2px;
            border: 8px solid var(--border-dark);
            box-shadow: 
                0 0 0 2px var(--border-medium),
                inset 0 0 0 2px var(--border-medium),
                0 20px 60px rgba(0,0,0,0.9);
            padding: 0;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            animation: slideDown 0.3s ease;
        }

        /* Profile modal scrollbar */
        .profile-content::-webkit-scrollbar {
            width: 16px;
        }

        .profile-content::-webkit-scrollbar-track {
            background: var(--border-medium);
            border: 2px solid var(--border-dark);
        }

        .profile-content::-webkit-scrollbar-thumb {
            background: var(--border-light);
            border: 2px solid var(--border-dark);
        }

        .profile-content::-webkit-scrollbar-thumb:hover {
            background: #4a3829;
        }

        .profile-content {
            scrollbar-width: auto;
            scrollbar-color: var(--border-light) var(--border-medium);
        }

        .profile-header {
            background: linear-gradient(180deg, var(--border-medium) 0%, var(--border-light) 100%);
            border-bottom: 4px solid var(--border-dark);
            padding: 20px;
            text-align: center;
            box-shadow: inset 0 -4px 8px rgba(0,0,0,0.3);
        }

        .profile-name {
            font-family: 'MedievalSharp', 'Courier New', monospace;
            font-size: 2em;
            font-weight: bold;
            color: var(--gold);
            text-shadow: 
                3px 3px 0 var(--border-dark),
                4px 4px 10px rgba(0,0,0,0.8);
            letter-spacing: 3px;
            text-transform: uppercase;
            margin: 0;
        }

        .profile-body {
            padding: 30px;
        }

        .profile-photo-container {
            text-align: center;
            margin: 0 0 20px 0;
            padding: 15px;
            background: var(--panel-dark);
            border: 3px solid var(--border-dark);
            box-shadow: inset 2px 2px 4px rgba(0,0,0,0.2);
        }

        .profile-photo {
            width: 200px;
            height: 200px;
            object-fit: cover;
            border: 5px solid var(--border-dark);
            box-shadow: 
                0 0 0 2px var(--border-medium),
                4px 4px 0 var(--border-dark),
                0 8px 16px rgba(0,0,0,0.5);
            border-radius: 8px;
            display: block;
            margin: 0 auto;
        }

        .profile-photo-label {
            margin-top: 10px;
            font-size: 0.85em;
            color: var(--text-secondary);
            font-style: italic;
        }

        .profile-section {
            background: var(--panel-bg);
            border: 4px solid var(--border-dark);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 
                inset 2px 2px 4px rgba(0,0,0,0.2),
                2px 2px 0 var(--border-medium);
        }

        .profile-section-title {
            font-family: 'MedievalSharp', 'Courier New', monospace;
            font-size: 1.4em;
            font-weight: bold;
            color: var(--text-color);
            text-align: center;
            margin-bottom: 15px;
            text-shadow: 1px 1px 0 var(--gold-text);
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .profile-stat {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 2px solid var(--container-bg);
            font-size: 1.1em;
        }

        .profile-stat:last-child {
            border-bottom: none;
        }

        .profile-stat-label {
            font-weight: bold;
            color: var(--text-secondary);
        }

        .profile-stat-value {
            color: #8b4513;
            font-weight: bold;
        }

        [data-theme="night"] .profile-stat-value {
            color: #fbbf24;
        }

        .profile-rank-badge {
            display: block;
            font-size: 1.8em;
            margin: 10px 0;
            text-align: center;
        }

        /* Badge System */
        .badge-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin: 20px 0;
            padding: 15px;
            background: var(--panel-dark);
            border: 3px solid var(--border-dark);
            box-shadow: inset 2px 2px 4px rgba(0,0,0,0.2);
        }

        .badge {
            text-align: center;
            padding: 15px 10px;
            border: 3px solid var(--border-medium);
            background: var(--panel-bg);
            box-shadow: 2px 2px 0 var(--border-medium);
            position: relative;
            transition: all 0.3s ease;
        }

        .badge img {
            width: 60px;
            height: 60px;
            display: block;
            margin: 0 auto;
        }

        .badge.locked {
            opacity: 0.3;
            filter: grayscale(100%) brightness(0.7);
        }

        .badge.locked img {
            content: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 60 60"><text x="50%" y="50%" text-anchor="middle" dy=".3em" font-size="40" fill="%23999">❌</text></svg>');
        }

        .badge.unlocked {
            box-shadow: 
                2px 2px 0 var(--border-medium),
                0 0 10px rgba(255, 215, 0, 0.4),
                inset 0 0 10px rgba(255, 215, 0, 0.2);
            animation: badgeGlow 3s ease-in-out infinite;
        }

        @keyframes badgeGlow {
            0%, 100% { 
                box-shadow: 
                    2px 2px 0 var(--border-medium),
                    0 0 10px rgba(255, 215, 0, 0.4),
                    inset 0 0 10px rgba(255, 215, 0, 0.2);
            }
            50% { 
                box-shadow: 
                    2px 2px 0 var(--border-medium),
                    0 0 20px rgba(255, 215, 0, 0.6),
                    inset 0 0 15px rgba(255, 215, 0, 0.3);
            }
        }

        .badge-name {
            font-size: 0.75em;
            color: var(--text-secondary);
            margin-top: 8px;
            font-weight: bold;
            text-align: center;
        }

        .profile-close {
            background: linear-gradient(180deg, var(--border-medium) 0%, var(--border-light) 100%);
            border: 4px solid var(--border-dark);
            color: var(--gold);
            padding: 12px 30px;
            cursor: pointer;
            font-family: 'MedievalSharp', 'Courier New', monospace;
            font-size: 1.2em;
            font-weight: bold;
            box-shadow: 3px 3px 0 var(--border-dark);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            width: 100%;
            margin-top: 10px;
        }

        .profile-close:hover {
            background: linear-gradient(180deg, #a0805a 0%, #6b5943 100%);
            transform: translate(1px, 1px);
            box-shadow: 2px 2px 0 var(--border-dark);
        }

        .profile-close:active {
            transform: translate(3px, 3px);
            box-shadow: none;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideDown {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        /* Better mobile optimization */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                border: 4px solid var(--border-dark);
                box-shadow: 
                    0 0 0 1px var(--border-medium),
                    inset 0 0 0 1px var(--border-medium),
                    0 5px 15px rgba(0,0,0,0.7);
            }
            
            .header {
                padding: 0;
            }
            
            h1 {
                font-size: 1.8em;
                letter-spacing: 2px;
                margin-bottom: 5px;
            }
            
            .quest-text {
                font-size: 2em;
                letter-spacing: 8px;
                padding-left: 8px;
                margin: -5px 0 10px 0;
                text-shadow: 
                    1px 1px 0 var(--border-light),
                    2px 2px 0 #4a3829,
                    2px 2px 0 var(--border-dark),
                    3px 3px 5px rgba(0,0,0,0.7);
            }
            
            .quest-separator {
                margin: 10px auto;
            }
            
            .subtitle {
                font-size: 1.2em;
                letter-spacing: 1.1px;
            }
            
            .content-area {
                padding: 20px 15px;
            }
            
            .panel {
                padding: 15px;
                margin: 20px 0;
            }
            
            .panel-title {
                font-size: 1.3em;
                letter-spacing: 2px;
            }
            
            .metal-row {
                padding: 10px 10px 10px 20px;
                font-size: 1.1em;
                flex-direction: row;
                gap: 5px;
            }
            
            .dwarf-row {
                padding: 10px 10px 10px 20px;
                font-size: 1em;
                flex-direction: row;
                gap: 5px;
            }

            .dwarf-rank {
                position: static;
                text-align: center;
            }

            .dwarf-name {
                text-align: center;
            }

            .dwarf-gp {
                text-align: center;
            }
            
            .total-value {
                font-size: .9em;
                padding: 15px;
            }
            
            .apply-button {
                font-size: 1.1em;
                padding: 12px 30px;
            }
            
            .quote {
                font-size: 0.9em;
                padding: 15px;
            }
            
            /* Mobile adjustments for profile modal */
            .profile-content {
                width: 95%;
                max-height: 90vh;
            }
            
            .profile-name {
                font-size: 1.5em !important;
                letter-spacing: 2px;
            }

            .profile-rank-badge {
                font-size: 1.3em !important;
                margin: 5px 0;
            }
            
            .profile-body {
                padding: 20px 15px;
            }
            
            .profile-stat {
                font-size: 0.95em;
            }

            .badge-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 8px;
                padding: 10px;
            }

            .badge {
                padding: 10px 5px;
            }

            .badge img {
                width: 50px;
                height: 50px;
            }

            .badge-name {
                font-size: 0.65em;
            }

            /* Mobile adjustments for application modal */
            .application-content {
                width: 100%;
                max-height: 95vh;
            }

            .application-title {
                font-size: 1.3em;
                letter-spacing: 2px;
            }

            .application-body iframe {
                min-height: 500px;
            }
        }

        /* Show thin pillars on larger mobile devices */
        @media (min-width: 600px) and (max-width: 900px) {
            body::before,
            body::after {
                display: block;
                width: 40px;
                background-size: 40px auto;
            }
            
            .shadow-gradient-left,
            .shadow-gradient-right {
                display: block;
                width: 150px;
            }
            
            .shadow-gradient-left {
                background: linear-gradient(90deg, 
                    rgba(0, 0, 0, 0.7) 0%,
                    rgba(0, 0, 0, 0.3) 40px,
                    transparent 150px
                );
            }
            
            .shadow-gradient-right {
                background: linear-gradient(270deg, 
                    rgba(0, 0, 0, 0.7) 0%,
                    rgba(0, 0, 0, 0.3) 40px,
                    transparent 150px
                );
            }
        }
    </style>
</head>
<body>
    <!-- Theme Toggle Button -->
    <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle day/night mode">
        <span class="theme-icon" id="theme-icon">☀️</span>
    </button>

    <div class="shadow-gradient-left"></div>
    <div class="shadow-gradient-right"></div>
    
    <!-- Torches with your images -->
    <div class="torch torch-left">
        <img src="torch.gif" alt="Torch" class="torch-image">
        <div class="torch-glow"></div>
    </div>
    
    <div class="torch torch-right">
        <img src="torch.gif" alt="Torch" class="torch-image">
        <div class="torch-glow"></div>
    </div>
    
    <div class="container">
        <div class="header">
            <img src="landscapebannerday.jpg" alt="Cofoundry Quest - The Valorforge" class="header-banner" id="header-banner">
        </div>
        
        <div class="content-area">
            <div class="intro">
                <div class="intro-scroll-top"></div>
                <div class="intro-scroll-bottom"></div>
                
                <p>Cofoundry is an invite only, dwarven-fantasy themed metal collecting co-op LARP game where we turn loot into treasure. 
                Join a Quest Party or adventure solo, collect treasure, earn Glory Points - 1 point per pound of copper or 10 per ounce of silver.</p>
                
                <p>We melt our copper and cast it into bars. Other metals get scrapped for "vulgar currency" to buy silver and gold. 
                Liquidation can only occur with a 90% vote, almost certainly ensuring the hoard only ever accumulates. If liquidation occurs, payout is based on player's GP, ensuring payout based on participation. 
                Beyond that, parts of the hoard can be sold for vulgar currency to expand your local Cofoundry Commonwealth's Valorforge.</p>
                
                <p>It's a long-term experiment to see how much precious metal we can accumulate together. Part LARP, part dwarven investment club, part environmental scavenging project, 100% real metal. 
                Want to quest with us?</p>
            </div>
            
            <div class="panel">
                <div class="panel-title">THE HOARD</div>
                <div id="hoard-data" class="loading">Loading The Hoard...</div>
            </div>
            
            <div class="panel">
                <div class="panel-title">🏆 LEADERBOARD 🏆</div>
                <div id="leaderboard-data" class="loading">Loading Leaderboard...</div>
            </div>
            
            <div class="button-container">
                <button class="apply-button" onclick="openApplicationModal()">
                    APPLY TO JOIN THE FELLOWSHIP
                </button>
                <a href="https://discord.gg/R2WTXwbYah" class="discord-link" target="_blank">
                    Already a member? Join our Discord →
                </a>
            </div>
            
            <div class="quote" id="random-quote">
                <!-- Quote will be inserted here by JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // CONFIGURATION
        const SHEET_ID = '1-LJvYKvw0Pgt6vCA6aSFROMwsmY3JLraujWUSVbpAd8';
        const DWARVES_PER_PAGE = 10;
        
        // Badge System - 6 badges (2 rows x 3 columns) with images
        const BADGES = [
            { title: "Copper Collector", image: "copperbadge.png", threshold: 10 },
            { title: "Bronze Hauler", image: "bronzebadge.png", threshold: 50 },
            { title: "Silver Seeker", image: "silverbadge.png", threshold: 100 },
            { title: "Hoard Builder", image: "hoardbuilderbadge.png", threshold: 500 },
            { title: "Elder Champion", image: "elderchampionbadge.png", threshold: 1000 },
            { title: "Gold Guardian", image: "goldbadge.png", threshold: 5000 }
        ];
        
        // Global state for leaderboard
        let allDwarves = [];
        let currentPage = 1;
        let photoAssignmentsCache = null;
        
        // ROTATING QUOTES
        const FELLOWSHIP_QUOTES = [
            "We measure wealth in weight, not promises.",
            "The Hoard grows. It does not shrink.",
            "Every pound of copper, every ounce of silver, is a permanent contribution to something greater than yourself.",
            "What was stolen, we reclaim. What we forge, we keep.",
            "Value is not what you can spend, but what you can hold.",
            "We build what will outlast us all.",
            "The fellowship forges together what no individual could achieve alone.",
            "From scattered scrap, a mountain of metal.",
            "What the surface world discards, the dwarves reclaim.",
            "Each bar cast is a small victory against forgetting.",
            "The vulgar count their promises. We count our ounces.",
            "Wealth without weight is merely words.",
            "The furnace knows no lies. Only metal, heat, and truth.",
            "What hands have made, hands shall keep.",
            "Glory is not given. It is earned, pound by pound.",
            "The Hoard is the proof. The Fellowship is the power.",
            "Scrap today, treasure tomorrow, legacy forever.",
            "The mountain grows one stone at a time. The Hoard grows one quest at a time.",
            "Hollow Lords discarded it. Dwarven labor reclaimed it. The Hoard holds it.",
            "Value lies not in the promise of gold, but in the weight of it.",
            "We forge the future by melting the past.",
            "The bars remember every hand that forged them.",
            "What we build together, no one can take alone.",
            "Weight is truth. Purity is proof. The Hoard is both.",
            "From the furnace, permanence. From the fellowship, power.",
            "The ledger shows what dwarven labor creates. The vault holds what dwarven labor keeps.",
            "Every bar is a vote of confidence in the collective.",
            "What seems impossible to one becomes inevitable for many.",
            "We hoard not from fear of scarcity, but from love of abundance.",
            "The question is not if we can accumulate, but how much.",
            "Metal does not forget. The Hoard does not diminish. The Fellowship does not surrender.",
            "Every ounce is an argument. Every bar is a statement. The Hoard is the proof.",
            "The dwarves dig deeply because the surface is hollow.",
            "Cooperation beats competition when the goal is measured in centuries.",
            "The vault secures metal. The fellowship secures meaning.",
            "From scrap, through fire, into forever.",
            "The Hoard is patient. The Fellowship is persistent. Victory is inevitable.",
            "Each quest adds to the whole. Each dwarf strengthens the many."
        ];
        
        function getRandomQuote() {
            return FELLOWSHIP_QUOTES[Math.floor(Math.random() * FELLOWSHIP_QUOTES.length)];
        }
        
        function displayRandomQuote() {
            const quote = getRandomQuote();
            document.getElementById('random-quote').textContent = `"${quote}"`;
        }
        
        // Get emoji for title
        function getTitleEmoji(title) {
            const titleEmojis = {
                "The Cofounder": "👑",
                "Gold Guardian": "🟡",
                "Elder Champion": "⚔️",
                "Hoard Builder": "🏗️",
                "Silver Seeker": "⚪",
                "Bronze Hauler": "🟤",
                "Copper Collector": "🔶",
                "Apprentice Scrapper": "🔨"
            };
            return titleEmojis[title] || "⚒️";
        }

        // Get badge status for a dwarf
        function getBadgeStatus(dwarfGP) {
            return BADGES.map(badge => ({
                ...badge,
                unlocked: dwarfGP >= badge.threshold
            }));
        }

        // Generate badge HTML with images
        function generateBadgeHTML(badges) {
            let html = '<div class="badge-grid">';
            badges.forEach(badge => {
                const statusClass = badge.unlocked ? 'unlocked' : 'locked';
                html += `
                    <div class="badge ${statusClass}">
                        <img src="${badge.image}" alt="${badge.title}">
                        <div class="badge-name">${badge.title}</div>
                    </div>
                `;
            });
            html += '</div>';
            return html;
        }

        // Fetch photo assignments from Google Sheets
        async function fetchPhotoAssignments() {
            try {
                const sheetUrl = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=Dwarf%20Photos`;
                const response = await fetch(sheetUrl);
                const text = await response.text();
                
                const jsonMatch = text.match(/google\.visualization\.Query\.setResponse\((.*)\);?\s*$/);
                const json = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(text.substr(47).slice(0, -2));
                
                const rows = json.table.rows;
                const assignments = {};
                
                // Build assignments object from sheet
                for (let i = 0; i < rows.length; i++) {
                    const cells = rows[i].c;
                    if (cells && cells[0] && cells[1]) {
                        const dwarfName = cells[0].v;
                        const photoFilename = cells[1].v;
                        if (dwarfName && photoFilename) {
                            assignments[dwarfName] = photoFilename;
                        }
                    }
                }
                
                photoAssignmentsCache = assignments;
                console.log('Loaded photo assignments:', assignments);
                return assignments;
                
            } catch (error) {
                console.error('Error fetching photo assignments:', error);
                photoAssignmentsCache = {};
                return {};
            }
        }

        // Get photo for a dwarf (from cache)
        async function getPhotoForDwarf(dwarfName) {
            // Load assignments if not cached
            if (photoAssignmentsCache === null) {
                await fetchPhotoAssignments();
            }
            
            // Return photo if assigned, otherwise return null
            return photoAssignmentsCache[dwarfName] || null;
        }

        // Application Modal Functions
        function openApplicationModal() {
            const modalHTML = `
                <div class="application-modal active" id="applicationModal" onclick="closeApplicationModal(event)">
                    <div class="application-content" onclick="event.stopPropagation()">
                        <div class="application-header">
                            <h2 class="application-title">⚒ FELLOWSHIP APPLICATION ⚒</h2>
                        </div>
                        
                        <div class="application-body">
                            <iframe src="https://docs.google.com/forms/d/e/1FAIpQLScPLUOLOUzXK2vJF8q7oNlCnAMXCBqffq86Xl45qL_ES8f7oQ/viewform?embedded=true">
                                Loading…
                            </iframe>
                        </div>
                        
                        <button class="application-close" onclick="closeApplicationModal()">
                            CLOSE
                        </button>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            document.body.style.overflow = 'hidden';
        }

        function closeApplicationModal(event) {
            if (event && event.target.id !== 'applicationModal') return;
            
            const modal = document.getElementById('applicationModal');
            if (modal) {
                modal.remove();
            }
            
            document.body.style.overflow = 'auto';
        }

        // ============================================
        // DAY/NIGHT MODE THEME TOGGLE
        // ============================================

        function initTheme() {
            const savedTheme = localStorage.getItem('cofoundry-theme') || 'day';
            setTheme(savedTheme);
        }

        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('cofoundry-theme', theme);
            
            // Update icon
            const icon = document.getElementById('theme-icon');
            icon.textContent = theme === 'day' ? '☀️' : '🌙';
            
            // Update torch images
            const torches = document.querySelectorAll('.torch-image');
            torches.forEach(torch => {
                if (theme === 'day') {
                    torch.src = 'torch.gif';
                } else {
                    torch.src = 'unlittorch.png';
                }
            });
            
            // Update header banner
            const banner = document.getElementById('header-banner');
            if (banner) {
                if (theme === 'day') {
                    banner.src = 'landscapebannerday.jpg';
                } else {
                    banner.src = 'landscapebannernight.jpg';
                }
            }
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme') || 'day';
            const newTheme = currentTheme === 'day' ? 'night' : 'day';
            setTheme(newTheme);
        }
        
        async function fetchHoardData() {
            try {
                const sheetUrl = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=The%20Hoard`;
                const response = await fetch(sheetUrl);
                const text = await response.text();
                
                const jsonMatch = text.match(/google\.visualization\.Query\.setResponse\((.*)\);?\s*$/);
                const json = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(text.substr(47).slice(0, -2));
                
                const rows = json.table.rows;
                let metals = {};
                
                for (let i = 0; i < rows.length; i++) {
                    const cells = rows[i].c;
                    if (cells && cells[0] && cells[1]) {
                        const metalName = cells[0].v;
                        const weight = parseFloat(cells[1].v) || 0;
                        
                        if (metalName && weight > 0 && !metalName.toLowerCase().includes('hoard')) {
                            metals[metalName] = weight;
                        }
                    }
                }
                
                const ledgerUrl = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=Metal%20Prices&range=B2:B7`;
                const pricesResponse = await fetch(ledgerUrl);
                const pricesText = await pricesResponse.text();
                const pricesJsonMatch = pricesText.match(/google\.visualization\.Query\.setResponse\((.*)\);?\s*$/);
                const pricesJson = pricesJsonMatch ? JSON.parse(pricesJsonMatch[1]) : JSON.parse(pricesText.substr(47).slice(0, -2));
                
                const pricesRows = pricesJson.table.rows;
                
                if (!pricesRows || pricesRows.length < 6) {
                    throw new Error('Not enough price data in sheet');
                }
                
                const prices = {
                    copper: parseFloat(pricesRows[0].c[0].v),
                    silver999: parseFloat(pricesRows[1].c[0].v),
                    silver925: parseFloat(pricesRows[2].c[0].v),
                    silver900: parseFloat(pricesRows[3].c[0].v),
                    gold: parseFloat(pricesRows[4].c[0].v),
                    platinum: parseFloat(pricesRows[5].c[0].v)
                };
                
                displayHoard(metals, prices);
                
            } catch (error) {
                console.error('Hoard ERROR:', error);
                document.getElementById('hoard-data').innerHTML = 
                    `<p style="color: #ff6b6b;">Error loading data.</p>`;
            }
        }
        
        function displayHoard(metals, prices) {
            let totalValue = 0;
            let html = '';
            
            for (const [metal, weight] of Object.entries(metals)) {
                const metalLower = metal.toLowerCase();
                let value = 0;
                let emoji = '';
                let unit = 'oz';
                
                if (metalLower.includes('copper')) {
                    value = weight * prices.copper * 0.999;
                    emoji = '🟤';
                } else if (metalLower.includes('silver')) {
                    emoji = '⚪';
                    if (metalLower.includes('.925') || metalLower.includes('925')) {
                        value = weight * prices.silver925 * 0.999;
                    } else if (metalLower.includes('.900') || metalLower.includes('900')) {
                        value = weight * prices.silver900 * 0.999;
                    } else {
                        value = weight * prices.silver999 * 0.999;
                    }
                } else if (metalLower.includes('gold')) {
                    value = weight * prices.gold * 0.999;
                    emoji = '🟡';
                } else if (metalLower.includes('platinum')) {
                    value = weight * prices.platinum * 0.999;
                    emoji = '⚫';
                } else if (metalLower.includes('vulgar') || metalLower.includes('currency')) {
                    value = weight;
                    emoji = '💵';
                    unit = 'USD';
                }
                
                totalValue += value;
                
                html += `
                    <div class="metal-row">
                        <span class="metal-name">${emoji} ${metal}</span>
                        <span class="metal-weight">${weight.toFixed(2)} ${unit}</span>
                    </div>
                `;
            }
            
            html += `
                <div class="total-value">
                    Estimated Value: 💰 $${totalValue.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}
                </div>
            `;
            
            document.getElementById('hoard-data').innerHTML = html;
        }
        
        async function fetchLeaderboard() {
            try {
                const ledgerUrl = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=The%20Great%20Ledger`;
                const response = await fetch(ledgerUrl);
                const text = await response.text();
                
                const jsonMatch = text.match(/google\.visualization\.Query\.setResponse\((.*)\);?\s*$/);
                const json = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(text.substr(47).slice(0, -2));
                
                const rows = json.table.rows;
                let dwarves = [];
                
                for (let i = 1; i < rows.length; i++) {
                    const cells = rows[i].c;
                    if (cells && cells[1] && cells[9]) {
                        const dwarfName = cells[1].v;
                        const gloryPoints = parseFloat(cells[9].v) || 0;
                        const title = cells[10] ? cells[10].v : "Apprentice Scrapper";
                        
                        if (dwarfName && !dwarfName.toLowerCase().includes('hoard') && gloryPoints > 0) {
                            dwarves.push({
                                name: dwarfName,
                                gp: gloryPoints,
                                title: title
                            });
                        }
                    }
                }
                
                dwarves.sort((a, b) => b.gp - a.gp);
                
                allDwarves = dwarves;
                currentPage = 1;
                displayLeaderboard();
                
            } catch (error) {
                console.error('Leaderboard ERROR:', error);
                document.getElementById('leaderboard-data').innerHTML = 
                    `<p style="color: #ff6b6b;">Error loading leaderboard.</p>`;
            }
        }
        
        function displayLeaderboard() {
            let html = '';
            
            if (allDwarves.length === 0) {
                html = '<p style="text-align: center; color: #8b6f47;">No Glory Points earned yet. Be the first!</p>';
            } else {
                const totalPages = Math.ceil(allDwarves.length / DWARVES_PER_PAGE);
                const startIndex = (currentPage - 1) * DWARVES_PER_PAGE;
                const endIndex = Math.min(startIndex + DWARVES_PER_PAGE, allDwarves.length);
                const pageDwarves = allDwarves.slice(startIndex, endIndex);
                
                pageDwarves.forEach((dwarf, pageIndex) => {
                    const actualRank = startIndex + pageIndex + 1;
                    let topThreeClass = '';
                    
                    if (actualRank <= 3) {
                        topThreeClass = 'top-three';
                    }
                    
                    html += `
                        <div class="dwarf-row ${topThreeClass}">
                            <span class="dwarf-rank">${actualRank}.</span>
                            <span class="dwarf-name">${dwarf.name}</span>
                            <span class="dwarf-gp">${dwarf.gp.toFixed(2)} GP</span>
                        </div>
                    `;
                });
                
                if (allDwarves.length > DWARVES_PER_PAGE) {
                    html += `
                        <div class="pagination-controls">
                            <button class="pagination-button" id="prev-button" ${currentPage === 1 ? 'disabled' : ''}>
                                ← PREV
                            </button>
                            <span class="pagination-info">
                                Page ${currentPage} of ${totalPages}
                            </span>
                            <button class="pagination-button" id="next-button" ${currentPage === totalPages ? 'disabled' : ''}>
                                NEXT →
                            </button>
                        </div>
                    `;
                }
                
                const totalGP = allDwarves.reduce((sum, d) => sum + d.gp, 0);
                
                html += `
                    <div class="leaderboard-stats">
                        Total Dwarves: ${allDwarves.length} | Total Glory: ${totalGP.toFixed(2)} GP
                    </div>
                `;
            }
            
            document.getElementById('leaderboard-data').innerHTML = html;
            
            if (allDwarves.length > DWARVES_PER_PAGE) {
                document.getElementById('prev-button').addEventListener('click', () => {
                    if (currentPage > 1) {
                        currentPage--;
                        displayLeaderboard();
                    }
                });
                
                document.getElementById('next-button').addEventListener('click', () => {
                    const totalPages = Math.ceil(allDwarves.length / DWARVES_PER_PAGE);
                    if (currentPage < totalPages) {
                        currentPage++;
                        displayLeaderboard();
                    }
                });
            }
            
            makeNamesClickable();
        }
        
        // DWARF PROFILE MODAL SYSTEM
        async function showDwarfProfile(dwarfName) {
            const dwarf = allDwarves.find(d => d.name === dwarfName);
            if (!dwarf) return;
            
            const rank = allDwarves.findIndex(d => d.name === dwarfName) + 1;
            
            const totalGP = allDwarves.reduce((sum, d) => sum + d.gp, 0);
            const percentOfTotal = totalGP > 0 ? ((dwarf.gp / totalGP) * 100).toFixed(1) : 0;
            
            const titleEmoji = getTitleEmoji(dwarf.title);
            const badges = getBadgeStatus(dwarf.gp);
            const badgeHTML = generateBadgeHTML(badges);
            
            // Get assigned photo for this dwarf (async)
            const photoFilename = await getPhotoForDwarf(dwarfName);
            const photoPath = photoFilename ? `dwarfphotos/${photoFilename}` : null;
            
            // Build photo HTML
            let photoHTML = '';
            if (photoPath) {
                photoHTML = `
                    <div class="profile-photo-container">
                        <img src="${photoPath}" alt="${dwarf.name}" class="profile-photo" 
                             onerror="this.style.display='none'; this.nextElementSibling.textContent='Portrait unavailable';">
                    </div>
                `;
            }
            
            const modalHTML = `
                <div class="profile-modal active" id="dwarfProfileModal" onclick="closeDwarfProfile(event)">
                    <div class="profile-content" onclick="event.stopPropagation()">
                        <div class="profile-header">
                            <h2 class="profile-name">⚒ ${dwarf.name} ⚒</h2>
                        </div>
                        
                        <div class="profile-body">
                            ${photoHTML}
                            
                            <div class="profile-section">
                                <div class="profile-section-title">⚒️ TITLE & BADGES ⚒️</div>
                                <div class="profile-rank-badge">${titleEmoji} ${dwarf.title}</div>
                                ${badgeHTML}
                            </div>
                            
                            <div class="profile-section">
                                <div class="profile-section-title">🏆 RANK & GLORY 🏆</div>
                                <div class="profile-stat">
                                    <span class="profile-stat-label">Glory Points:</span>
                                    <span class="profile-stat-value">${dwarf.gp.toFixed(2)} GP</span>
                                </div>
                                <div class="profile-stat">
                                    <span class="profile-stat-label">Rank:</span>
                                    <span class="profile-stat-value">#${rank} of ${allDwarves.length}</span>
                                </div>
                                <div class="profile-stat">
                                    <span class="profile-stat-label">Hoard Share:</span>
                                    <span class="profile-stat-value">${percentOfTotal}%</span>
                                </div>
                            </div>
                            
                            <button class="profile-close" onclick="closeDwarfProfile()">
                                CLOSE
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            document.body.style.overflow = 'hidden';
        }

        function closeDwarfProfile(event) {
            if (event && event.target.className !== 'profile-modal active') return;
            
            const modal = document.getElementById('dwarfProfileModal');
            if (modal) {
                modal.remove();
            }
            
            document.body.style.overflow = 'auto';
        }

        function makeNamesClickable() {
            document.querySelectorAll('.dwarf-name').forEach(nameElement => {
                nameElement.style.cursor = 'pointer';
                nameElement.addEventListener('click', function() {
                    const dwarfName = this.textContent.trim();
                    showDwarfProfile(dwarfName);
                });
            });
        }
        
        // Initialize everything
        initTheme();
        displayRandomQuote();
        fetchPhotoAssignments(); // Preload photo assignments
        fetchHoardData();
        fetchLeaderboard();
        
        setInterval(() => {
            fetchHoardData();
            fetchLeaderboard();
        }, 5 * 60 * 1000);
    </script>
</body>
</html>
