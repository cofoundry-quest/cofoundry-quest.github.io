<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Valorforge - The Cofoundry</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=MedievalSharp&family=Uncial+Antiqua&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
    font-family: 'MedievalSharp', 'Courier New', monospace;
    background: linear-gradient(135deg, #1a1a1a 0%, #2d2416 100%);
    color: #3d2817;
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
}

/* Castle wall borders - using tileable image */
body::before,
body::after {
    content: '';
    position: fixed;
    top: 0;
    bottom: 0;
    width: 120px;
    background-image: url('images/cobblestone.jpg');
    background-size: 120px auto;
    background-repeat: repeat-y;
    background-position: center;
    box-shadow: 
        inset 0 0 80px rgba(0,0,0,0.5),
        inset 20px 0 40px rgba(0,0,0,0.4),
        inset -20px 0 40px rgba(0,0,0,0.4);
    z-index: 1000;
    pointer-events: none;
    filter: brightness(0.8) contrast(1.1);
}

body::before {
    left: 0;
}

body::after {
    right: 0;
}

/* Responsive */
@media (max-width: 1200px) {
    body::before,
    body::after {
        width: 80px;
        background-size: 80px auto;
    }
}

@media (max-width: 900px) {
    body::before,
    body::after {
        width: 40px;
        background-size: 40px auto;
    }
}

@media (max-width: 600px) {
    body::before,
    body::after {
        display: none;
    }
}
        
        .container {
            max-width: 900px;
            background: #c9b896;
            background-image: 
                radial-gradient(rgba(0,0,0,.1) 1px, transparent 1px),
                radial-gradient(rgba(0,0,0,.1) 1px, transparent 1px);
            background-size: 4px 4px;
            background-position: 0 0, 2px 2px;
            padding: 0;
            border: 8px solid #3d2817;
            box-shadow: 
                0 0 0 2px #8b6f47,
                inset 0 0 0 2px #8b6f47,
                0 10px 30px rgba(0,0,0,0.7);
        }
        
        .header {
            background: linear-gradient(180deg, #8b6f47 0%, #5d4a36 100%);
            border-bottom: 4px solid #3d2817;
            padding: 30px 20px;
            text-align: center;
            box-shadow: inset 0 -4px 8px rgba(0,0,0,0.3);
        }
        
        h1 {
            font-family: 'MedievalSharp', 'Courier New', monospace;
            font-size: 3em;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 
                4px 4px 0 #3d2817,
                -2px -2px 0 #3d2817,
                2px -2px 0 #3d2817,
                -2px 2px 0 #3d2817,
                2px 2px 0 #3d2817,
                5px 5px 10px rgba(0,0,0,0.8);
            letter-spacing: 5px;
            margin-bottom: 10px;
            text-transform: uppercase;
        }
        
        .subtitle {
            font-family: 'MedievalSharp', 'Courier New', monospace;
            font-size: 1.2em;
            color: #d4af37;
            font-style: italic;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
            letter-spacing: 2px;
        }

        .quest-text {
            font-family: 'MedievalSharp', 'Courier New', monospace;
            font-size: 4.5em;
            font-weight: bold;
            color: #c9783a;
            text-align: center;
            letter-spacing: 25px;
            margin: -5px 0 15px 0;
            text-transform: uppercase;
            text-shadow: 
                2px 2px 0 #5d4a36,
                3px 3px 0 #4a3829,
                4px 4px 0 #3d2817,
                5px 5px 0 #2b1810,
                6px 6px 10px rgba(0,0,0,0.7),
                7px 7px 15px rgba(0,0,0,0.5);
            padding-left: 25px;
        }

        .quest-separator {
            width: 80%;
            height: 3px;
            background: #5d4a36;
            margin: 15px auto;
            box-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }
        
        .content-area {
            padding: 30px;
        }
        
        .intro {
            background: #e8dcc4;
            border: 4px solid #3d2817;
            border-radius: 0;
            padding: 20px;
            margin-bottom: 30px;
            font-size: 0.95em;
            line-height: 1.7;
            box-shadow: 
                inset 2px 2px 4px rgba(0,0,0,0.2),
                2px 2px 0 #8b6f47;
        }
        
        .intro p {
            margin-bottom: 15px;
        }
        
        .intro p:last-child {
            margin-bottom: 0;
        }
        
        .panel {
            background: #e8dcc4;
            border: 4px solid #3d2817;
            padding: 20px;
            margin: 30px 0;
            box-shadow: 
                inset 2px 2px 4px rgba(0,0,0,0.2),
                4px 4px 0 #8b6f47;
            position: relative;
        }
        
        .panel::before {
            content: '';
            position: absolute;
            top: -4px;
            left: -4px;
            right: -4px;
            height: 8px;
            background: linear-gradient(90deg, #8b6f47 0%, #5d4a36 50%, #8b6f47 100%);
        }
        
        .panel-title {
            font-family: 'MedievalSharp', 'Courier New', monospace;
            font-size: 1.8em;
            font-weight: bold;
            color: #3d2817;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 2px 2px 0 #d4af37;
            letter-spacing: 3px;
            text-transform: uppercase;
        }
        
        .metal-row, .dwarf-row {
            background: #d4c5a9;
            border: 3px solid #3d2817;
            padding: 12px 15px;
            margin: 8px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 2px 2px 0 #8b6f47;
            font-size: 1em;
        }
        
        .metal-row:hover, .dwarf-row:hover {
            background: #c9b896;
        }
        
        .dwarf-row.top-three {
            background: #ffd700;
            border-color: #8b6f47;
            box-shadow: 
                2px 2px 0 #8b6f47,
                0 0 10px rgba(255, 215, 0, 0.3);
        }
        
        .metal-name, .dwarf-name {
            font-weight: bold;
            flex: 1;
            text-align: left;
        }
        
        .metal-weight, .dwarf-gp {
            color: #8b4513;
            font-weight: bold;
        }
        
        .dwarf-rank {
            font-weight: bold;
            min-width: 50px;
            text-align: left;
            font-size: 1.2em;
        }
        
        .total-value {
            background: linear-gradient(180deg, #ffd700 0%, #daa520 100%);
            border: 4px solid #3d2817;
            padding: 20px;
            margin-top: 20px;
            text-align: center;
            font-size: 1.8em;
            font-weight: bold;
            color: #3d2817;
            text-shadow: 1px 1px 0 #fff;
            box-shadow: 
                inset 0 2px 4px rgba(255,255,255,0.5),
                2px 2px 0 #8b6f47;
        }
        
        .leaderboard-stats {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 3px solid #8b6f47;
            text-align: center;
            color: #5d4a36;
            font-size: 0.9em;
        }
        
        .pagination-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 3px solid #8b6f47;
        }
        
        .pagination-button {
            background: linear-gradient(180deg, #8b6f47 0%, #5d4a36 100%);
            border: 3px solid #3d2817;
            color: #ffd700;
            padding: 10px 20px;
            cursor: pointer;
            font-family: 'MedievalSharp', 'Courier New', monospace;
            font-size: 1em;
            font-weight: bold;
            box-shadow: 2px 2px 0 #3d2817;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        
        .pagination-button:hover:not(:disabled) {
            background: linear-gradient(180deg, #a0805a 0%, #6b5943 100%);
            transform: translate(1px, 1px);
            box-shadow: 1px 1px 0 #3d2817;
        }
        
        .pagination-button:active:not(:disabled) {
            transform: translate(2px, 2px);
            box-shadow: none;
        }
        
        .pagination-button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        
        .pagination-info {
            color: #5d4a36;
            font-weight: bold;
        }
        
        .discord-button {
            display: inline-block;
            margin: 30px auto;
            padding: 15px 40px;
            background: linear-gradient(180deg, #7289da 0%, #5865f2 100%);
            color: white;
            text-decoration: none;
            font-size: 1.3em;
            font-weight: bold;
            border: 4px solid #3d2817;
            cursor: pointer;
            box-shadow: 4px 4px 0 #3d2817;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            transition: all 0.1s;
        }
        
        .discord-button:hover {
            background: linear-gradient(180deg, #8b9fe8 0%, #6b7bff 100%);
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0 #3d2817;
        }
        
        .discord-button:active {
            transform: translate(4px, 4px);
            box-shadow: none;
        }
        
        .button-container {
            text-align: center;
        }
        
        .quote {
            background: #8b6f47;
            border: 4px solid #3d2817;
            padding: 20px;
            margin-top: 30px;
            font-style: italic;
            color: #ffd700;
            text-align: center;
            font-size: 1em;
            line-height: 1.6;
            box-shadow: 
                inset 2px 2px 4px rgba(0,0,0,0.3),
                2px 2px 0 #5d4a36;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .loading {
            font-size: 1.2em;
            color: #8b6f47;
            text-align: center;
            padding: 20px;
        }
        
        /* Retro scrollbar */
        ::-webkit-scrollbar {
            width: 16px;
        }
        
        ::-webkit-scrollbar-track {
            background: #8b6f47;
            border: 2px solid #3d2817;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #5d4a36;
            border: 2px solid #3d2817;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #4a3829;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>⚒ COFOUNDRY ⚒</h1>
            <div class="quest-text">QUEST</div>
            <div class="quest-separator"></div>
            <p class="subtitle">Home of the Valorforge</p>
        </div>
        
        <div class="content-area">
            <div class="intro">
                <p>Cofoundry is an invite only, dwarven-fantasy themed metal collecting co-op LARP game where we turn loot into treasure. 
                Join a Quest Party or adventure solo, collect treasure, earn Glory Points - 1 point per pound of copper or 10 per ounce of silver.</p>
                
                <p>We melt our copper and cast it into bars. Other metals get scrapped for "vulgar currency" to buy silver and gold. 
                Liquidation can only occur with a 90% vote, almost certainly ensuring the hoard only ever accumulates. If liquidation occurs, payout is based on player's GP, ensuring payout based on participation. 
                Beyond that, parts of the hoard can be sold for vulgar currency to expand your local Cofoundry Commonwealth's Valorforge.</p>
                
                <p>It's a long-term experiment to see how much precious metal we can accumulate together. Part LARP, part dwarven investment club, part environmental scavenging project, 100% real metal. 
                Want to quest with us?</p>
            </div>
            
            <div class="panel">
                <div class="panel-title">THE HOARD</div>
                <div id="hoard-data" class="loading">Loading The Hoard...</div>
            </div>
            
            <div class="panel">
                <div class="panel-title">🏆 GLORY LEADERBOARD 🏆</div>
                <div id="leaderboard-data" class="loading">Loading Leaderboard...</div>
            </div>
            
            <div class="button-container">
                <a href="https://discord.gg/R2WTXwbYah" class="discord-button" target="_blank">
                    JOIN THE FELLOWSHIP
                </a>
            </div>
            
            <div class="quote" id="random-quote">
                <!-- Quote will be inserted here by JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // CONFIGURATION
        const SHEET_ID = '1-LJvYKvw0Pgt6vCA6aSFROMwsmY3JLraujWUSVbpAd8';
        const DWARVES_PER_PAGE = 10;
        
        // Global state for leaderboard
        let allDwarves = [];
        let currentPage = 1;
        
        // ROTATING QUOTES
        const FELLOWSHIP_QUOTES = [
            "We measure wealth in weight, not promises.",
            "The Hoard grows. It does not shrink.",
            "Every pound of copper, every ounce of silver, is a permanent contribution to something greater than yourself.",
            "What was stolen, we reclaim. What we forge, we keep.",
            "Value is not what you can spend, but what you can hold.",
            "We build what will outlast us all.",
            "The fellowship forges together what no individual could achieve alone.",
            "From scattered scrap, a mountain of metal.",
            "What the surface world discards, the dwarves reclaim.",
            "Each bar cast is a small victory against forgetting.",
            "The vulgar count their promises. We count our ounces.",
            "Wealth without weight is merely words.",
            "The furnace knows no lies. Only metal, heat, and truth.",
            "What hands have made, hands shall keep.",
            "Glory is not given. It is earned, pound by pound.",
            "The Hoard is the proof. The Fellowship is the power.",
            "Scrap today, treasure tomorrow, legacy forever.",
            "The mountain grows one stone at a time. The Hoard grows one quest at a time.",
            "Hollow Lords discarded it. Dwarven labor reclaimed it. The Hoard holds it.",
            "Value lies not in the promise of gold, but in the weight of it.",
            "We forge the future by melting the past.",
            "The bars remember every hand that forged them.",
            "What we build together, no one can take alone.",
            "Weight is truth. Purity is proof. The Hoard is both.",
            "From the furnace, permanence. From the fellowship, power.",
            "The ledger shows what dwarven labor creates. The vault holds what dwarven labor keeps.",
            "Every bar is a vote of confidence in the collective.",
            "What seems impossible to one becomes inevitable for many.",
            "We hoard not from fear of scarcity, but from love of abundance.",
            "The question is not if we can accumulate, but how much.",
            "Metal does not forget. The Hoard does not diminish. The Fellowship does not surrender.",
            "Every ounce is an argument. Every bar is a statement. The Hoard is the proof.",
            "The dwarves dig deeply because the surface is hollow.",
            "Cooperation beats competition when the goal is measured in centuries.",
            "The vault secures metal. The fellowship secures meaning.",
            "From scrap, through fire, into forever.",
            "The Hoard is patient. The Fellowship is persistent. Victory is inevitable.",
            "Each quest adds to the whole. Each dwarf strengthens the many."
        ];
        
        function getRandomQuote() {
            return FELLOWSHIP_QUOTES[Math.floor(Math.random() * FELLOWSHIP_QUOTES.length)];
        }
        
        function displayRandomQuote() {
            const quote = getRandomQuote();
            document.getElementById('random-quote').textContent = `"${quote}"`;
        }
        
        async function fetchHoardData() {
            try {
                const sheetUrl = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=The%20Hoard`;
                const response = await fetch(sheetUrl);
                const text = await response.text();
                
                const jsonMatch = text.match(/google\.visualization\.Query\.setResponse\((.*)\);?\s*$/);
                const json = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(text.substr(47).slice(0, -2));
                
                const rows = json.table.rows;
                let metals = {};
                
                for (let i = 0; i < rows.length; i++) {
                    const cells = rows[i].c;
                    if (cells && cells[0] && cells[1]) {
                        const metalName = cells[0].v;
                        const weight = parseFloat(cells[1].v) || 0;
                        
                        if (metalName && weight > 0 && !metalName.toLowerCase().includes('hoard')) {
                            metals[metalName] = weight;
                        }
                    }
                }
                
                const ledgerUrl = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=The%20Great%20Ledger&range=K2:K5`;
                const pricesResponse = await fetch(ledgerUrl);
                const pricesText = await pricesResponse.text();
                const pricesJsonMatch = pricesText.match(/google\.visualization\.Query\.setResponse\((.*)\);?\s*$/);
                const pricesJson = pricesJsonMatch ? JSON.parse(pricesJsonMatch[1]) : JSON.parse(pricesText.substr(47).slice(0, -2));
                
                const pricesRows = pricesJson.table.rows;
                
                if (!pricesRows || pricesRows.length < 4) {
                    throw new Error('Not enough price data in sheet');
                }
                
                const prices = {
                    copper: parseFloat(pricesRows[0].c[0].v),
                    silver: parseFloat(pricesRows[1].c[0].v),
                    gold: parseFloat(pricesRows[2].c[0].v),
                    platinum: parseFloat(pricesRows[3].c[0].v)
                };
                
                displayHoard(metals, prices);
                
            } catch (error) {
                console.error('Hoard ERROR:', error);
                document.getElementById('hoard-data').innerHTML = 
                    `<p style="color: #ff6b6b;">Error loading data.</p>`;
            }
        }
        
        function displayHoard(metals, prices) {
            let totalValue = 0;
            let html = '';
            
            for (const [metal, weight] of Object.entries(metals)) {
                const metalLower = metal.toLowerCase();
                let value = 0;
                let emoji = '';
                let unit = 'oz';
                
                if (metalLower.includes('copper')) {
                    value = weight * prices.copper * 0.999;
                    emoji = '🟤';
                } else if (metalLower.includes('silver')) {
                    value = weight * prices.silver * 0.999;
                    emoji = '⚪';
                } else if (metalLower.includes('gold')) {
                    value = weight * prices.gold * 0.999;
                    emoji = '🟡';
                } else if (metalLower.includes('platinum')) {
                    value = weight * prices.platinum * 0.999;
                    emoji = '⚫';
                } else if (metalLower.includes('vulgar') || metalLower.includes('currency')) {
                    value = weight;
                    emoji = '💵';
                    unit = 'USD';
                }
                
                totalValue += value;
                
                html += `
                    <div class="metal-row">
                        <span class="metal-name">${emoji} ${metal}</span>
                        <span class="metal-weight">${weight.toFixed(2)} ${unit}</span>
                    </div>
                `;
            }
            
            html += `
                <div class="total-value">
                    💰 $${totalValue.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}
                </div>
            `;
            
            document.getElementById('hoard-data').innerHTML = html;
        }
        
        async function fetchLeaderboard() {
            try {
                const ledgerUrl = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=The%20Great%20Ledger`;
                const response = await fetch(ledgerUrl);
                const text = await response.text();
                
                const jsonMatch = text.match(/google\.visualization\.Query\.setResponse\((.*)\);?\s*$/);
                const json = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(text.substr(47).slice(0, -2));
                
                const rows = json.table.rows;
                let dwarves = [];
                
                for (let i = 1; i < rows.length; i++) {
                    const cells = rows[i].c;
                    if (cells && cells[1] && cells[7]) {
                        const dwarfName = cells[1].v;
                        const gloryPoints = parseFloat(cells[7].v) || 0;
                        
                        if (dwarfName && !dwarfName.toLowerCase().includes('hoard') && gloryPoints > 0) {
                            dwarves.push({
                                name: dwarfName,
                                gp: gloryPoints
                            });
                        }
                    }
                }
                
                dwarves.sort((a, b) => b.gp - a.gp);
                
                allDwarves = dwarves;
                currentPage = 1;
                displayLeaderboard();
                
            } catch (error) {
                console.error('Leaderboard ERROR:', error);
                document.getElementById('leaderboard-data').innerHTML = 
                    `<p style="color: #ff6b6b;">Error loading leaderboard.</p>`;
            }
        }
        
        function displayLeaderboard() {
            let html = '';
            
            if (allDwarves.length === 0) {
                html = '<p style="text-align: center; color: #8b6f47;">No Glory Points earned yet. Be the first!</p>';
            } else {
                const totalPages = Math.ceil(allDwarves.length / DWARVES_PER_PAGE);
                const startIndex = (currentPage - 1) * DWARVES_PER_PAGE;
                const endIndex = Math.min(startIndex + DWARVES_PER_PAGE, allDwarves.length);
                const pageDwarves = allDwarves.slice(startIndex, endIndex);
                
                pageDwarves.forEach((dwarf, pageIndex) => {
                    const actualRank = startIndex + pageIndex + 1;
                    let rankDisplay = '';
                    let topThreeClass = '';
                    
                    if (actualRank === 1) {
                        rankDisplay = '🥇';
                        topThreeClass = 'top-three';
                    } else if (actualRank === 2) {
                        rankDisplay = '🥈';
                        topThreeClass = 'top-three';
                    } else if (actualRank === 3) {
                        rankDisplay = '🥉';
                        topThreeClass = 'top-three';
                    } else {
                        rankDisplay = `${actualRank}.`;
                    }
                    
                    html += `
                        <div class="dwarf-row ${topThreeClass}">
                            <span class="dwarf-rank">${rankDisplay}</span>
                            <span class="dwarf-name">${dwarf.name}</span>
                            <span class="dwarf-gp">${dwarf.gp.toFixed(2)} GP</span>
                        </div>
                    `;
                });
                
                if (allDwarves.length > DWARVES_PER_PAGE) {
                    html += `
                        <div class="pagination-controls">
                            <button class="pagination-button" id="prev-button" ${currentPage === 1 ? 'disabled' : ''}>
                                ← PREV
                            </button>
                            <span class="pagination-info">
                                Page ${currentPage} of ${totalPages}
                            </span>
                            <button class="pagination-button" id="next-button" ${currentPage === totalPages ? 'disabled' : ''}>
                                NEXT →
                            </button>
                        </div>
                    `;
                }
                
                const totalGP = allDwarves.reduce((sum, d) => sum + d.gp, 0);
                
                html += `
                    <div class="leaderboard-stats">
                        Total Dwarves: ${allDwarves.length} | Total Glory: ${totalGP.toFixed(2)} GP
                    </div>
                `;
            }
            
            document.getElementById('leaderboard-data').innerHTML = html;
            
            if (allDwarves.length > DWARVES_PER_PAGE) {
                document.getElementById('prev-button').addEventListener('click', () => {
                    if (currentPage > 1) {
                        currentPage--;
                        displayLeaderboard();
                    }
                });
                
                document.getElementById('next-button').addEventListener('click', () => {
                    const totalPages = Math.ceil(allDwarves.length / DWARVES_PER_PAGE);
                    if (currentPage < totalPages) {
                        currentPage++;
                        displayLeaderboard();
                    }
                });
            }
        }
        
        displayRandomQuote();
        fetchHoardData();
        fetchLeaderboard();
        
        setInterval(() => {
            fetchHoardData();
            fetchLeaderboard();
        }, 5 * 60 * 1000);
    </script>
</body>
</html>
