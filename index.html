<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cofoundry Quest - Dwarven Metal Collecting LARP Game | The Valorforge</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Cofoundry Quest is a dwarven-fantasy themed metal collecting co-op LARP game. Join our fellowship, collect precious metals, earn Glory Points, and build The Hoard together.">
    <meta name="keywords" content="cofoundry, cofoundry quest, valorforge, metal collecting, LARP game, dwarven fantasy, precious metals, copper collecting, silver stacking, scrap metal">
    <meta name="author" content="Cofoundry Quest">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://cofoundry.quest/">
    <meta property="og:title" content="Cofoundry Quest - The Valorforge">
    <meta property="og:description" content="Join our dwarven fellowship and turn scrap into treasure. A real-world metal collecting LARP game.">
    <meta property="og:site_name" content="Cofoundry Quest">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Cofoundry Quest - The Valorforge">
    <meta name="twitter:description" content="Dwarven-fantasy metal collecting co-op LARP game where we turn loot into treasure.">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://cofoundry.quest/">

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=MedievalSharp&family=Uncial+Antiqua&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'MedievalSharp', 'Courier New', monospace;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2416 100%);
            color: #3d2817;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
        }
        
        /* Castle wall borders - cobblestone texture */
        body::before,
        body::after {
            content: '';
            position: fixed;
            top: 0;
            bottom: 0;
            width: 120px;
            background-image: url('cobblestone.png');
            background-size: 120px auto;
            background-repeat: repeat-y;
            background-position: center;
            box-shadow: 
                inset 0 0 80px rgba(0,0,0,0.5),
                inset 20px 0 40px rgba(0,0,0,0.4),
                inset -20px 0 40px rgba(0,0,0,0.4);
            z-index: 1000;
            pointer-events: none;
            filter: brightness(0.8) contrast(1.1);
        }

        body::before {
            left: 0;
        }

        body::after {
            right: 0;
        }

        /* Shadow gradient behind pillars */
        .shadow-gradient-left,
        .shadow-gradient-right {
            position: fixed;
            top: 0;
            bottom: 0;
            width: 400px;
            pointer-events: none;
            z-index: 999;
        }

        .shadow-gradient-left {
            left: 0;
            background: linear-gradient(90deg, 
                rgba(0, 0, 0, 0.8) 0%,
                rgba(0, 0, 0, 0.5) 120px,
                rgba(0, 0, 0, 0.3) 200px,
                rgba(0, 0, 0, 0.1) 300px,
                transparent 400px
            );
        }

        .shadow-gradient-right {
            right: 0;
            background: linear-gradient(270deg, 
                rgba(0, 0, 0, 0.8) 0%,
                rgba(0, 0, 0, 0.5) 120px,
                rgba(0, 0, 0, 0.3) 200px,
                rgba(0, 0, 0, 0.1) 300px,
                transparent 400px
            );
        }

        /* Responsive */
        @media (max-width: 1200px) {
            body::before,
            body::after {
                width: 80px;
                background-size: 80px auto;
            }
            
            .shadow-gradient-left,
            .shadow-gradient-right {
                width: 300px;
            }
            
            .shadow-gradient-left {
                background: linear-gradient(90deg, 
                    rgba(0, 0, 0, 0.8) 0%,
                    rgba(0, 0, 0, 0.4) 80px,
                    rgba(0, 0, 0, 0.2) 150px,
                    transparent 300px
                );
            }
            
            .shadow-gradient-right {
                background: linear-gradient(270deg, 
                    rgba(0, 0, 0, 0.8) 0%,
                    rgba(0, 0, 0, 0.4) 80px,
                    rgba(0, 0, 0, 0.2) 150px,
                    transparent 300px
                );
            }
        }

        @media (max-width: 900px) {
            body::before,
            body::after {
                width: 40px;
                background-size: 40px auto;
            }
            
            .shadow-gradient-left,
            .shadow-gradient-right {
                width: 200px;
            }
        }

        @media (max-width: 600px) {
            body::before,
            body::after {
                display: none;
            }
            
            .shadow-gradient-left,
            .shadow-gradient-right {
                display: none;
            }
        }
        
        .container {
            max-width: 900px;
            background: #c9b896;
            background-image: 
                radial-gradient(rgba(0,0,0,.1) 1px, transparent 1px),
                radial-gradient(rgba(0,0,0,.1) 1px, transparent 1px);
            background-size: 4px 4px;
            background-position: 0 0, 2px 2px;
            padding: 0;
            border: 8px solid #3d2817;
            box-shadow: 
                0 0 0 2px #8b6f47,
                inset 0 0 0 2px #8b6f47,
                0 10px 30px rgba(0,0,0,0.7);
        }
        
        .header {
            background: linear-gradient(180deg, #8b6f47 0%, #5d4a36 100%);
            border-bottom: 4px solid #3d2817;
            padding: 30px 20px;
            text-align: center;
            box-shadow: inset 0 -4px 8px rgba(0,0,0,0.3);
        }
        
        h1 {
            font-family: 'MedievalSharp', 'Courier New', monospace;
            font-size: 3em;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 
                4px 4px 0 #3d2817,
                -2px -2px 0 #3d2817,
                2px -2px 0 #3d2817,
                -2px 2px 0 #3d2817,
                2px 2px 0 #3d2817,
                5px 5px 10px rgba(0,0,0,0.8);
            letter-spacing: 5px;
            margin-bottom: 10px;
            text-transform: uppercase;
        }
        
        .subtitle {
            font-family: 'MedievalSharp', 'Courier New', monospace;
            font-size: 1.2em;
            color: #d4af37;
            font-style: italic;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
            letter-spacing: 2px;
        }

        .quest-text {
            font-family: 'MedievalSharp', 'Courier New', monospace;
            font-size: 4.5em;
            font-weight: bold;
            color: #c9783a;
            text-align: center;
            letter-spacing: 25px;
            margin: -5px 0 15px 0;
            text-transform: uppercase;
            text-shadow: 
                2px 2px 0 #5d4a36,
                3px 3px 0 #4a3829,
                4px 4px 0 #3d2817,
                5px 5px 0 #2b1810,
                6px 6px 10px rgba(0,0,0,0.7),
                7px 7px 15px rgba(0,0,0,0.5);
            padding-left: 25px;
        }

        .quest-separator {
            width: 80%;
            height: 3px;
            background: #5d4a36;
            margin: 15px auto;
            box-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }
        
        .content-area {
            padding: 30px;
        }
        
        .intro {
            background: #e8dcc4;
            border: 4px solid #3d2817;
            border-radius: 0;
            padding: 20px;
            margin-bottom: 30px;
            font-size: 0.95em;
            line-height: 1.7;
            box-shadow: 
                inset 2px 2px 4px rgba(0,0,0,0.2),
                2px 2px 0 #8b6f47;
            text-align: center;
        }
        
        .intro p {
            margin-bottom: 15px;
        }
        
        .intro p:last-child {
            margin-bottom: 0;
        }
        
        .panel {
            background: #e8dcc4;
            border: 4px solid #3d2817;
            padding: 20px;
            margin: 30px 0;
            box-shadow: 
                inset 2px 2px 4px rgba(0,0,0,0.2),
                4px 4px 0 #8b6f47;
            position: relative;
        }
        
        .panel::before {
            content: '';
            position: absolute;
            top: -4px;
            left: -4px;
            right: -4px;
            height: 8px;
            background: linear-gradient(90deg, #8b6f47 0%, #5d4a36 50%, #8b6f47 100%);
        }
        
        .panel-title {
            font-family: 'MedievalSharp', 'Courier New', monospace;
            font-size: 1.8em;
            font-weight: bold;
            color: #3d2817;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 2px 2px 0 #d4af37;
            letter-spacing: 3px;
            text-transform: uppercase;
        }
        
        .metal-row {
            background: #d4c5a9;
            border: 3px solid #3d2817;
            padding: 12px 15px;
            margin: 8px 0;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            box-shadow: 2px 2px 0 #8b6f47;
            font-size: 1.5em;
            text-align: center;
        }
        
        .metal-row:hover {
            background: #c9b896;
        }

        .dwarf-row {
            background: #d4c5a9;
            border: 3px solid #3d2817;
            padding: 12px 15px 12px 45px;
            margin: 8px 0;
            display: flex;
            justify-content: flex-start;
            align-items: center;
            gap: 20px;
            box-shadow: 2px 2px 0 #8b6f47;
            font-size: 1em;
            text-align: center;
            position: relative;
        }

        .dwarf-row:hover {
            background: #c9b896;
        }
        
        .dwarf-row.top-three {
            background: #ffd700;
            border-color: #8b6f47;
            box-shadow: 
                2px 2px 0 #8b6f47,
                0 0 10px rgba(255, 215, 0, 0.3);
        }

        .dwarf-rank {
            font-weight: bold;
            min-width: 30px;
            font-size: 1.2em;
            text-align: left;
            position: absolute;
            left: 15px;
        }

        .dwarf-name {
            cursor: pointer;
            transition: color 0.2s;
            flex: 1;
            text-align: center;
            font-weight: bold;
        }

        .dwarf-name:hover {
            color: #ffd700;
            text-decoration: underline;
        }

        .dwarf-gp {
            color: #8b4513;
            font-weight: bold;
            min-width: 100px;
            text-align: right;
        }
        
        .metal-name {
            font-weight: bold;
        }
        
        .metal-weight {
            color: #8b4513;
            font-weight: bold;
        }
        
        .total-value {
            background: linear-gradient(180deg, #ffd700 0%, #daa520 100%);
            border: 4px solid #3d2817;
            padding: 20px;
            margin-top: 20px;
            text-align: center;
            font-size: 1em;
            font-weight: bold;
            color: #3d2817;
            text-shadow: 1px 1px 0 #fff;
            box-shadow: 
                inset 0 2px 4px rgba(255,255,255,0.5),
                2px 2px 0 #8b6f47;
        }
        
        .leaderboard-stats {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 3px solid #8b6f47;
            text-align: center;
            color: #5d4a36;
            font-size: 0.9em;
        }
        
        .pagination-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 3px solid #8b6f47;
        }
        
        .pagination-button {
            background: linear-gradient(180deg, #8b6f47 0%, #5d4a36 100%);
            border: 3px solid #3d2817;
            color: #ffd700;
            padding: 10px 20px;
            cursor: pointer;
            font-family: 'MedievalSharp', 'Courier New', monospace;
            font-size: 1em;
            font-weight: bold;
            box-shadow: 2px 2px 0 #3d2817;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        
        .pagination-button:hover:not(:disabled) {
            background: linear-gradient(180deg, #a0805a 0%, #6b5943 100%);
            transform: translate(1px, 1px);
            box-shadow: 1px 1px 0 #3d2817;
        }
        
        .pagination-button:active:not(:disabled) {
            transform: translate(2px, 2px);
            box-shadow: none;
        }
        
        .pagination-button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        
        .pagination-info {
            color: #5d4a36;
            font-weight: bold;
        }
        
        .discord-button {
            display: inline-block;
            margin: 30px auto;
            padding: 15px 40px;
            background: linear-gradient(180deg, #7289da 0%, #5865f2 100%);
            color: white;
            text-decoration: none;
            font-size: 1.3em;
            font-weight: bold;
            border: 4px solid #3d2817;
            cursor: pointer;
            box-shadow: 4px 4px 0 #3d2817;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            transition: all 0.1s;
        }
        
        .discord-button:hover {
            background: linear-gradient(180deg, #8b9fe8 0%, #6b7bff 100%);
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0 #3d2817;
        }
        
        .discord-button:active {
            transform: translate(4px, 4px);
            box-shadow: none;
        }
        
        .button-container {
            text-align: center;
        }
        
        .quote {
            background: #8b6f47;
            border: 4px solid #3d2817;
            padding: 20px;
            margin-top: 30px;
            font-style: italic;
            color: #ffd700;
            text-align: center;
            font-size: 1em;
            line-height: 1.6;
            box-shadow: 
                inset 2px 2px 4px rgba(0,0,0,0.3),
                2px 2px 0 #5d4a36;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .loading {
            font-size: 1.2em;
            color: #8b6f47;
            text-align: center;
            padding: 20px;
        }
        
        /* Retro scrollbar */
        ::-webkit-scrollbar {
            width: 16px;
        }
        
        ::-webkit-scrollbar-track {
            background: #8b6f47;
            border: 2px solid #3d2817;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #5d4a36;
            border: 2px solid #3d2817;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #4a3829;
        }
        
        /* Dwarf Profile Modal */
        .profile-modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            animation: fadeIn 0.3s ease;
        }

        .profile-modal.active {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .profile-content {
            background: #c9b896;
            background-image: 
                radial-gradient(rgba(0,0,0,.1) 1px, transparent 1px),
                radial-gradient(rgba(0,0,0,.1) 1px, transparent 1px);
            background-size: 4px 4px;
            background-position: 0 0, 2px 2px;
            border: 8px solid #3d2817;
            box-shadow: 
                0 0 0 2px #8b6f47,
                inset 0 0 0 2px #8b6f47,
                0 20px 60px rgba(0,0,0,0.9);
            padding: 0;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            animation: slideDown 0.3s ease;
        }

        .profile-header {
            background: linear-gradient(180deg, #8b6f47 0%, #5d4a36 100%);
            border-bottom: 4px solid #3d2817;
            padding: 20px;
            text-align: center;
            box-shadow: inset 0 -4px 8px rgba(0,0,0,0.3);
        }

        .profile-name {
            font-family: 'MedievalSharp', 'Courier New', monospace;
            font-size: 2em;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 
                3px 3px 0 #3d2817,
                4px 4px 10px rgba(0,0,0,0.8);
            letter-spacing: 3px;
            text-transform: uppercase;
            margin: 0;
        }

        .profile-body {
            padding: 30px;
        }

        .profile-section {
            background: #e8dcc4;
            border: 4px solid #3d2817;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 
                inset 2px 2px 4px rgba(0,0,0,0.2),
                2px 2px 0 #8b6f47;
        }

        .profile-section-title {
            font-family: 'MedievalSharp', 'Courier New', monospace;
            font-size: 1.4em;
            font-weight: bold;
            color: #3d2817;
            text-align: center;
            margin-bottom: 15px;
            text-shadow: 1px 1px 0 #d4af37;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .profile-stat {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 2px solid #c9b896;
            font-size: 1.1em;
        }

        .profile-stat:last-child {
            border-bottom: none;
        }

        .profile-stat-label {
            font-weight: bold;
            color: #5d4a36;
        }

        .profile-stat-value {
            color: #8b4513;
            font-weight: bold;
        }

        .profile-rank-badge {
            display: inline-block;
            font-size: 3em;
            margin: 10px 0;
            text-align: center;
        }

        .profile-close {
            background: linear-gradient(180deg, #8b6f47 0%, #5d4a36 100%);
            border: 4px solid #3d2817;
            color: #ffd700;
            padding: 12px 30px;
            cursor: pointer;
            font-family: 'MedievalSharp', 'Courier New', monospace;
            font-size: 1.2em;
            font-weight: bold;
            box-shadow: 3px 3px 0 #3d2817;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            width: 100%;
            margin-top: 10px;
        }

        .profile-close:hover {
            background: linear-gradient(180deg, #a0805a 0%, #6b5943 100%);
            transform: translate(1px, 1px);
            box-shadow: 2px 2px 0 #3d2817;
        }

        .profile-close:active {
            transform: translate(3px, 3px);
            box-shadow: none;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideDown {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        /* Better mobile optimization */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                border: 4px solid #3d2817;
                box-shadow: 
                    0 0 0 1px #8b6f47,
                    inset 0 0 0 1px #8b6f47,
                    0 5px 15px rgba(0,0,0,0.7);
            }
            
            .header {
                padding: 20px 15px;
            }
            
            h1 {
                font-size: 1.8em;
                letter-spacing: 2px;
                margin-bottom: 5px;
            }
            
            .quest-text {
                font-size: 2em;
                letter-spacing: 8px;
                padding-left: 8px;
                margin: -5px 0 10px 0;
                text-shadow: 
                    1px 1px 0 #5d4a36,
                    2px 2px 0 #4a3829,
                    2px 2px 0 #3d2817,
                    3px 3px 5px rgba(0,0,0,0.7);
            }
            
            .quest-separator {
                margin: 10px auto;
            }
            
            .subtitle {
                font-size: 1.2em;
                letter-spacing: 1.1px;
            }
            
            .content-area {
                padding: 20px 15px;
            }
            
            .intro {
                padding: 15px;
                font-size: 0.85em;
                line-height: 1.6;
            }
            
            .panel {
                padding: 15px;
                margin: 20px 0;
            }
            
            .panel-title {
                font-size: 1.3em;
                letter-spacing: 2px;
            }
            
            .metal-row {
                padding: 10px 10px 10px 20px;
                font-size: 1.2em;
                flex-direction: column;
                gap: 5px;
            }
            
            .dwarf-row {
                padding: 10px 10px 10px 20px;
                font-size: 1em;
                flex-direction: row;
                gap: 5px;
            }

            .dwarf-rank {
                position: static;
                text-align: center;
            }

            .dwarf-name {
                text-align: center;
            }

            .dwarf-gp {
                text-align: center;
            }
            
            .total-value {
                font-size: .9em;
                padding: 15px;
            }
            
            .discord-button {
                font-size: 1.1em;
                padding: 12px 30px;
            }
            
            .quote {
                font-size: 0.9em;
                padding: 15px;
            }
            
            /* Mobile adjustments for modal */
            .profile-content {
                width: 95%;
                max-height: 90vh;
            }
            
            .profile-name {
                font-size: 1.5em;
                letter-spacing: 2px;
            }
            
            .profile-body {
                padding: 20px 15px;
            }
            
            .profile-stat {
                font-size: 0.95em;
            }
        }

        /* Show thin pillars on larger mobile devices */
        @media (min-width: 600px) and (max-width: 900px) {
            body::before,
            body::after {
                display: block;
                width: 40px;
                background-size: 40px auto;
            }
            
            .shadow-gradient-left,
            .shadow-gradient-right {
                display: block;
                width: 150px;
            }
            
            .shadow-gradient-left {
                background: linear-gradient(90deg, 
                    rgba(0, 0, 0, 0.7) 0%,
                    rgba(0, 0, 0, 0.3) 40px,
                    transparent 150px
                );
            }
            
            .shadow-gradient-right {
                background: linear-gradient(270deg, 
                    rgba(0, 0, 0, 0.7) 0%,
                    rgba(0, 0, 0, 0.3) 40px,
                    transparent 150px
                );
            }
        }
    </style>
</head>
<body>
    <div class="shadow-gradient-left"></div>
    <div class="shadow-gradient-right"></div>
    
    <div class="container">
        <div class="header">
            <h1>‚öí COFOUNDRY ‚öí</h1>
            <div class="quest-text">QUEST</div>
            <div class="quest-separator"></div>
            <p class="subtitle">Home of the Valorforge</p>
        </div>
        
        <div class="content-area">
            <div class="intro">
                <p>Cofoundry is an invite only, dwarven-fantasy themed metal collecting co-op LARP game where we turn loot into treasure. 
                Join a Quest Party or adventure solo, collect treasure, earn Glory Points - 1 point per pound of copper or 10 per ounce of silver.</p>
                
                <p>We melt our copper and cast it into bars. Other metals get scrapped for "vulgar currency" to buy silver and gold. 
                Liquidation can only occur with a 90% vote, almost certainly ensuring the hoard only ever accumulates. If liquidation occurs, payout is based on player's GP, ensuring payout based on participation. 
                Beyond that, parts of the hoard can be sold for vulgar currency to expand your local Cofoundry Commonwealth's Valorforge.</p>
                
                <p>It's a long-term experiment to see how much precious metal we can accumulate together. Part LARP, part dwarven investment club, part environmental scavenging project, 100% real metal. 
                Want to quest with us?</p>
            </div>
            
            <div class="panel">
                <div class="panel-title">THE HOARD</div>
                <div id="hoard-data" class="loading">Loading The Hoard...</div>
            </div>
            
            <div class="panel">
                <div class="panel-title">üèÜ LEADERBOARD üèÜ</div>
                <div id="leaderboard-data" class="loading">Loading Leaderboard...</div>
            </div>
            
            <div class="button-container">
                <a href="https://discord.gg/R2WTXwbYah" class="discord-button" target="_blank">
                    JOIN THE FELLOWSHIP
                </a>
            </div>
            
            <div class="quote" id="random-quote">
                <!-- Quote will be inserted here by JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // CONFIGURATION
        const SHEET_ID = '1-LJvYKvw0Pgt6vCA6aSFROMwsmY3JLraujWUSVbpAd8';
        const DWARVES_PER_PAGE = 10;
        
        // Global state for leaderboard
        let allDwarves = [];
        let currentPage = 1;
        
        // ROTATING QUOTES
        const FELLOWSHIP_QUOTES = [
            "We measure wealth in weight, not promises.",
            "The Hoard grows. It does not shrink.",
            "Every pound of copper, every ounce of silver, is a permanent contribution to something greater than yourself.",
            "What was stolen, we reclaim. What we forge, we keep.",
            "Value is not what you can spend, but what you can hold.",
            "We build what will outlast us all.",
            "The fellowship forges together what no individual could achieve alone.",
            "From scattered scrap, a mountain of metal.",
            "What the surface world discards, the dwarves reclaim.",
            "Each bar cast is a small victory against forgetting.",
            "The vulgar count their promises. We count our ounces.",
            "Wealth without weight is merely words.",
            "The furnace knows no lies. Only metal, heat, and truth.",
            "What hands have made, hands shall keep.",
            "Glory is not given. It is earned, pound by pound.",
            "The Hoard is the proof. The Fellowship is the power.",
            "Scrap today, treasure tomorrow, legacy forever.",
            "The mountain grows one stone at a time. The Hoard grows one quest at a time.",
            "Hollow Lords discarded it. Dwarven labor reclaimed it. The Hoard holds it.",
            "Value lies not in the promise of gold, but in the weight of it.",
            "We forge the future by melting the past.",
            "The bars remember every hand that forged them.",
            "What we build together, no one can take alone.",
            "Weight is truth. Purity is proof. The Hoard is both.",
            "From the furnace, permanence. From the fellowship, power.",
            "The ledger shows what dwarven labor creates. The vault holds what dwarven labor keeps.",
            "Every bar is a vote of confidence in the collective.",
            "What seems impossible to one becomes inevitable for many.",
            "We hoard not from fear of scarcity, but from love of abundance.",
            "The question is not if we can accumulate, but how much.",
            "Metal does not forget. The Hoard does not diminish. The Fellowship does not surrender.",
            "Every ounce is an argument. Every bar is a statement. The Hoard is the proof.",
            "The dwarves dig deeply because the surface is hollow.",
            "Cooperation beats competition when the goal is measured in centuries.",
            "The vault secures metal. The fellowship secures meaning.",
            "From scrap, through fire, into forever.",
            "The Hoard is patient. The Fellowship is persistent. Victory is inevitable.",
            "Each quest adds to the whole. Each dwarf strengthens the many."
        ];
        
        function getRandomQuote() {
            return FELLOWSHIP_QUOTES[Math.floor(Math.random() * FELLOWSHIP_QUOTES.length)];
        }
        
        function displayRandomQuote() {
            const quote = getRandomQuote();
            document.getElementById('random-quote').textContent = `"${quote}"`;
        }
        
        // Get emoji for title
        function getTitleEmoji(title) {
            const titleEmojis = {
                "The Cofounder": "üëë",
                "Gold Guardian": "üü°",
                "Elder Champion": "‚öîÔ∏è",
                "Hoard Builder": "üèóÔ∏è",
                "Silver Seeker": "‚ö™",
                "Bronze Hauler": "üü§",
                "Copper Collector": "üî∂",
                "Apprentice Scrapper": "üî®"
            };
            return titleEmojis[title] || "‚öíÔ∏è";
        }
        
        async function fetchHoardData() {
            try {
                const sheetUrl = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=The%20Hoard`;
                const response = await fetch(sheetUrl);
                const text = await response.text();
                
                const jsonMatch = text.match(/google\.visualization\.Query\.setResponse\((.*)\);?\s*$/);
                const json = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(text.substr(47).slice(0, -2));
                
                const rows = json.table.rows;
                let metals = {};
                
                for (let i = 0; i < rows.length; i++) {
                    const cells = rows[i].c;
                    if (cells && cells[0] && cells[1]) {
                        const metalName = cells[0].v;
                        const weight = parseFloat(cells[1].v) || 0;
                        
                        if (metalName && weight > 0 && !metalName.toLowerCase().includes('hoard')) {
                            metals[metalName] = weight;
                        }
                    }
                }
                
                const ledgerUrl = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=Metal%20Prices&range=B2:B7`;
                const pricesResponse = await fetch(ledgerUrl);
                const pricesText = await pricesResponse.text();
                const pricesJsonMatch = pricesText.match(/google\.visualization\.Query\.setResponse\((.*)\);?\s*$/);
                const pricesJson = pricesJsonMatch ? JSON.parse(pricesJsonMatch[1]) : JSON.parse(pricesText.substr(47).slice(0, -2));
                
                const pricesRows = pricesJson.table.rows;
                
                if (!pricesRows || pricesRows.length < 6) {
                    throw new Error('Not enough price data in sheet');
                }
                
                const prices = {
                    copper: parseFloat(pricesRows[0].c[0].v),
                    silver999: parseFloat(pricesRows[1].c[0].v),
                    silver925: parseFloat(pricesRows[2].c[0].v),
                    silver900: parseFloat(pricesRows[3].c[0].v),
                    gold: parseFloat(pricesRows[4].c[0].v),
                    platinum: parseFloat(pricesRows[5].c[0].v)
                };
                
                displayHoard(metals, prices);
                
            } catch (error) {
                console.error('Hoard ERROR:', error);
                document.getElementById('hoard-data').innerHTML = 
                    `<p style="color: #ff6b6b;">Error loading data.</p>`;
            }
        }
        
        function displayHoard(metals, prices) {
            let totalValue = 0;
            let html = '';
            
            for (const [metal, weight] of Object.entries(metals)) {
                const metalLower = metal.toLowerCase();
                let value = 0;
                let emoji = '';
                let unit = 'oz';
                
                if (metalLower.includes('copper')) {
                    value = weight * prices.copper * 0.999;
                    emoji = 'üü§';
                } else if (metalLower.includes('silver')) {
                    emoji = '‚ö™';
                    if (metalLower.includes('.925') || metalLower.includes('925')) {
                        value = weight * prices.silver925 * 0.999;
                    } else if (metalLower.includes('.900') || metalLower.includes('900')) {
                        value = weight * prices.silver900 * 0.999;
                    } else {
                        value = weight * prices.silver999 * 0.999;
                    }
                } else if (metalLower.includes('gold')) {
                    value = weight * prices.gold * 0.999;
                    emoji = 'üü°';
                } else if (metalLower.includes('platinum')) {
                    value = weight * prices.platinum * 0.999;
                    emoji = '‚ö´';
                } else if (metalLower.includes('vulgar') || metalLower.includes('currency')) {
                    value = weight;
                    emoji = 'üíµ';
                    unit = 'USD';
                }
                
                totalValue += value;
                
                html += `
                    <div class="metal-row">
                        <span class="metal-name">${emoji} ${metal}</span>
                        <span class="metal-weight">${weight.toFixed(2)} ${unit}</span>
                    </div>
                `;
            }
            
            html += `
                <div class="total-value">
                    Estimated Value:     üí∞ $${totalValue.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}
                </div>
            `;
            
            document.getElementById('hoard-data').innerHTML = html;
        }
        
        async function fetchLeaderboard() {
            try {
                const ledgerUrl = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=The%20Great%20Ledger`;
                const response = await fetch(ledgerUrl);
                const text = await response.text();
                
                const jsonMatch = text.match(/google\.visualization\.Query\.setResponse\((.*)\);?\s*$/);
                const json = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(text.substr(47).slice(0, -2));
                
                const rows = json.table.rows;
                let dwarves = [];
                
                for (let i = 1; i < rows.length; i++) {
                    const cells = rows[i].c;
                    if (cells && cells[1] && cells[9]) {
                        const dwarfName = cells[1].v;
                        const gloryPoints = parseFloat(cells[9].v) || 0;
                        const title = cells[10] ? cells[10].v : "Apprentice Scrapper";
                        
                        if (dwarfName && !dwarfName.toLowerCase().includes('hoard') && gloryPoints > 0) {
                            dwarves.push({
                                name: dwarfName,
                                gp: gloryPoints,
                                title: title
                            });
                        }
                    }
                }
                
                dwarves.sort((a, b) => b.gp - a.gp);
                
                allDwarves = dwarves;
                currentPage = 1;
                displayLeaderboard();
                
            } catch (error) {
                console.error('Leaderboard ERROR:', error);
                document.getElementById('leaderboard-data').innerHTML = 
                    `<p style="color: #ff6b6b;">Error loading leaderboard.</p>`;
            }
        }
        
        function displayLeaderboard() {
            let html = '';
            
            if (allDwarves.length === 0) {
                html = '<p style="text-align: center; color: #8b6f47;">No Glory Points earned yet. Be the first!</p>';
            } else {
                const totalPages = Math.ceil(allDwarves.length / DWARVES_PER_PAGE);
                const startIndex = (currentPage - 1) * DWARVES_PER_PAGE;
                const endIndex = Math.min(startIndex + DWARVES_PER_PAGE, allDwarves.length);
                const pageDwarves = allDwarves.slice(startIndex, endIndex);
                
                pageDwarves.forEach((dwarf, pageIndex) => {
                    const actualRank = startIndex + pageIndex + 1;
                    let topThreeClass = '';
                    
                    if (actualRank <= 3) {
                        topThreeClass = 'top-three';
                    }
                    
                    html += `
                        <div class="dwarf-row ${topThreeClass}">
                            <span class="dwarf-rank">${actualRank}.</span>
                            <span class="dwarf-name">${dwarf.name}</span>
                            <span class="dwarf-gp">${dwarf.gp.toFixed(2)} GP</span>
                        </div>
                    `;
                });
                
                if (allDwarves.length > DWARVES_PER_PAGE) {
                    html += `
                        <div class="pagination-controls">
                            <button class="pagination-button" id="prev-button" ${currentPage === 1 ? 'disabled' : ''}>
                                ‚Üê PREV
                            </button>
                            <span class="pagination-info">
                                Page ${currentPage} of ${totalPages}
                            </span>
                            <button class="pagination-button" id="next-button" ${currentPage === totalPages ? 'disabled' : ''}>
                                NEXT ‚Üí
                            </button>
                        </div>
                    `;
                }
                
                const totalGP = allDwarves.reduce((sum, d) => sum + d.gp, 0);
                
                html += `
                    <div class="leaderboard-stats">
                        Total Dwarves: ${allDwarves.length} | Total Glory: ${totalGP.toFixed(2)} GP
                    </div>
                `;
            }
            
            document.getElementById('leaderboard-data').innerHTML = html;
            
            if (allDwarves.length > DWARVES_PER_PAGE) {
                document.getElementById('prev-button').addEventListener('click', () => {
                    if (currentPage > 1) {
                        currentPage--;
                        displayLeaderboard();
                    }
                });
                
                document.getElementById('next-button').addEventListener('click', () => {
                    const totalPages = Math.ceil(allDwarves.length / DWARVES_PER_PAGE);
                    if (currentPage < totalPages) {
                        currentPage++;
                        displayLeaderboard();
                    }
                });
            }
            
            makeNamesClickable();
        }
        
        // DWARF PROFILE MODAL SYSTEM
        function showDwarfProfile(dwarfName) {
            const dwarf = allDwarves.find(d => d.name === dwarfName);
            if (!dwarf) return;
            
            const rank = allDwarves.findIndex(d => d.name === dwarfName) + 1;
            
            const totalGP = allDwarves.reduce((sum, d) => sum + d.gp, 0);
            const percentOfTotal = totalGP > 0 ? ((dwarf.gp / totalGP) * 100).toFixed(1) : 0;
            
            const titleEmoji = getTitleEmoji(dwarf.title);
            
            const modalHTML = `
                <div class="profile-modal active" id="dwarfProfileModal" onclick="closeDwarfProfile(event)">
                    <div class="profile-content" onclick="event.stopPropagation()">
                        <div class="profile-header">
                            <h2 class="profile-name">‚öí ${dwarf.name} ‚öí</h2>
                        </div>
                        
                        <div class="profile-body">
                            <div class="profile-section">
                                <div class="profile-section-title">üèÜ RANK & GLORY üèÜ</div>
                                <div class="profile-rank-badge">${titleEmoji} ${dwarf.title}</div>
                                <div class="profile-stat">
                                    <span class="profile-stat-label">Glory Points:</span>
                                    <span class="profile-stat-value">${dwarf.gp.toFixed(2)} GP</span>
                                </div>
                                <div class="profile-stat">
                                    <span class="profile-stat-label">Rank:</span>
                                    <span class="profile-stat-value">#${rank} of ${allDwarves.length}</span>
                                </div>
                                <div class="profile-stat">
                                    <span class="profile-stat-label">Hoard Share:</span>
                                    <span class="profile-stat-value">${percentOfTotal}%</span>
                                </div>
                            </div>
                            
                            <button class="profile-close" onclick="closeDwarfProfile()">
                                CLOSE
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            document.body.style.overflow = 'hidden';
        }

        function closeDwarfProfile(event) {
            if (event && event.target.className !== 'profile-modal active') return;
            
            const modal = document.getElementById('dwarfProfileModal');
            if (modal) {
                modal.remove();
            }
            
            document.body.style.overflow = 'auto';
        }

        function makeNamesClickable() {
            document.querySelectorAll('.dwarf-name').forEach(nameElement => {
                nameElement.style.cursor = 'pointer';
                nameElement.addEventListener('click', function() {
                    const dwarfName = this.textContent.trim();
                    showDwarfProfile(dwarfName);
                });
            });
        }
        
        displayRandomQuote();
        fetchHoardData();
        fetchLeaderboard();
        
        setInterval(() => {
            fetchHoardData();
            fetchLeaderboard();
        }, 5 * 60 * 1000);
    </script>
</body>
</html>
